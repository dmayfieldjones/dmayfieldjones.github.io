"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8716],{18716:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var i=r(75927);class s{ixxFile;ixFile;maxResults;constructor(e,t,r=20){this.ixxFile=e,this.ixFile=t,this.maxResults=r}async search(e,t){let r=[],s=e.split(" ")[0].toLowerCase(),a=await this._getBuffer(s,t);if(!a)return[];let{end:l,buffer:n}=a,o=!1;for(;!o;){let e=!1,a=n.toString(),c=a.slice(0,a.lastIndexOf("\n")).split("\n").filter(e=>!!e),u=[];for(let t of c){let r=t.split(" ")[0],i=r.startsWith(s);!e&&i&&(e=!0),r.slice(0,s.length)>s&&(o=!0),i&&u.push(t)}let f=u.flatMap(e=>{let[t,...r]=e.split(" ");return r.map(e=>[t,e.split(",")[0]])});if(r.length+f.length<this.maxResults&&!o){let e=await this.ixFile.read(i.Buffer.alloc(65536),0,65536,l,t);if(!e.bytesRead){r=r.concat(f);break}n=i.Buffer.concat([n,e.buffer]),l+=65536}else if(r.length+f.length>=this.maxResults||o){r=r.concat(f);break}}return(function(e,t){let r=new Set;return e.filter(e=>{let i=t(e);return!r.has(i)&&r.add(i)})})(r,e=>e[1]).slice(0,this.maxResults)}async getIndex(e){return(await this.ixxFile.readFile({encoding:"utf8",...e})).split("\n").filter(e=>!!e).map(e=>{let t=e.length-10;return[e.slice(0,t),Number.parseInt(e.slice(t),16)]})}async _getBuffer(e,t){let r=0,s=65536;for(let[i,a]of(await this.getIndex(t)))i.slice(0,e.length)<e&&(r=a,s=a+65536);let a=s-r;if(!(a<0))return{...await this.ixFile.read(i.Buffer.alloc(a),0,a,r,t),end:s}}}var a=r(4836),l=r(53394),n=r(92766),o=r(31177);function c(e){try{return decodeURIComponent(e)}catch(t){return e}}function u(e,t,r=15){let i=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,i-r)>0?"...":"")+e.slice(Math.max(0,i-r),i+t.length+r).trim()+(i+t.length<e.length?"...":"")}class f extends n.BaseAdapter{constructor(e,t,r){super(e,t,r);let i=(0,l.readConfObject)(e,"ixFilePath"),a=(0,l.readConfObject)(e,"ixxFilePath");if(!i)throw Error("must provide out.ix");if(!a)throw Error("must provide out.ixx");this.trixJs=new s((0,o.openLocation)(a,r),(0,o.openLocation)(i,r),1500)}async searchIndex(e){let t=e.queryString.toLowerCase(),r=t.split(" "),i=(await this.trixJs.search(t)).filter(([,e])=>r.every(t=>c(e).toLowerCase().includes(t))).map(([e,t])=>{let r=JSON.parse(t.replaceAll("|",",")),[i,s,...l]=r.map(e=>c(e)),n=l.findIndex(e=>!!e),o=l.map(e=>e.toLowerCase()).findIndex(t=>t.includes(e.toLowerCase())),f=l[n],h=l[o],x=-1!==o?u(h,e):void 0,d=u(f,e),p=x&&d.toLowerCase()!==x.toLowerCase()?`${d} (${x})`:d;return new a.Ay({locString:i,label:f,displayString:p,matchedObject:r.map(e=>decodeURIComponent(e)),trackId:s})});return"exact"===e.searchType?i.filter(t=>t.getLabel().toLowerCase()===e.queryString.toLowerCase()):i}freeResources(){}}}}]);
//# sourceMappingURL=8716.1789ee73b2b9dd00.js.map