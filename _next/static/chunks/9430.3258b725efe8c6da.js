"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5982,9430],{31371:(e,t,a)=>{a.d(t,{tP:()=>c,BL:()=>o});var n=a(82485),s=a(91986),i=a(75927);function r(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}async function l(e,t){let a;let n=await e.readFile(t);if(!(null==n?void 0:n.length))throw Error("No data read from FASTA index (FAI) file");let s=0,i=n.toString("utf8").split(/\r?\n/).filter(e=>/\S/.test(e)).map(e=>e.split("	")).filter(e=>""!==e[0]).map(e=>(a&&a.name===e[0]||(a={name:e[0],id:s},s+=1),{id:a.id,name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}));return{name:Object.fromEntries(i.map(e=>[e.name,e])),id:Object.fromEntries(i.map(e=>[e.id,e]))}}class o{constructor({fasta:e,fai:t,path:a,faiPath:s}){if(e)this.fasta=e;else if(a)this.fasta=new n.LocalFile(a);else throw Error("Need to pass filehandle for fasta or path to localfile");if(t)this.fai=t;else if(s)this.fai=new n.LocalFile(s);else if(a)this.fai=new n.LocalFile(`${a}.fai`);else throw Error("Need to pass filehandle for  or path to localfile")}async _getIndexes(e){return this.indexes||(this.indexes=l(this.fai,e)),this.indexes}async getSequenceNames(e){return Object.keys((await this._getIndexes(e)).name)}async getSequenceSizes(e){let t={};for(let a of Object.values((await this._getIndexes(e)).id))t[a.name]=a.length;return t}async getSequenceSize(e,t){var a;return null===(a=(await this._getIndexes(t)).name[e])||void 0===a?void 0:a.length}async hasReferenceSequence(e,t){return!!(await this._getIndexes(t)).name[e]}async getResiduesById(e,t,a,n){let s=(await this._getIndexes(n)).id[e];if(s)return this._fetchFromIndexEntry(s,t,a,n)}async getResiduesByName(e,t,a,n){let s=(await this._getIndexes(n)).name[e];if(s)return this._fetchFromIndexEntry(s,t,a,n)}async getSequence(e,t,a,n){return this.getResiduesByName(e,t,a,n)}async _fetchFromIndexEntry(e,t=0,a,n){let s=a;if(t<0)throw TypeError("regionStart cannot be less than 0");if((void 0===s||s>e.length)&&(s=e.length),t>=s)return"";let l=r(e,t),o=r(e,s)-l,c=i.Buffer.allocUnsafe(o);return await this.fasta.read(c,0,o,l,n),c.toString("utf8").replace(/\s+/g,"")}}class c extends o{constructor({fasta:e,path:t,fai:a,faiPath:n,gzi:i,gziPath:r}){super({fasta:e,path:t,fai:a,faiPath:n}),e&&i?this.fasta=new s.BgzfFilehandle({filehandle:e,gziFilehandle:i}):t&&r&&(this.fasta=new s.BgzfFilehandle({path:t,gziPath:r}))}}},49430:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});var n=a(31371),s=a(31177),i=a(55982);class r extends i.default{async setupPre(){let e=this.getConf("fastaLocation"),t=this.getConf("faiLocation"),a=this.getConf("gziLocation"),i={fasta:(0,s.openLocation)(e,this.pluginManager),fai:(0,s.openLocation)(t,this.pluginManager),gzi:(0,s.openLocation)(a,this.pluginManager)};return{fasta:new n.tP(i)}}}},55982:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var n=a(28126),s=a(31371),i=a(92766),r=a(54262),l=a(61078),o=a(31177),c=a(72471),f=a(28251);class h extends i.BaseSequenceAdapter{constructor(){super(...arguments),this.seqCache=new n.A({cache:new l.default({maxSize:200}),fill:async e=>{let{refName:t,start:a,end:n,fasta:s}=e;return s.getSequence(t,a,n)}})}async getRefNames(e){let{fasta:t}=await this.setup();return t.getSequenceNames()}async getRegions(e){let{fasta:t}=await this.setup(),a=await t.getSequenceSizes();return Object.keys(a).map(e=>({refName:e,start:0,end:a[e]}))}async setupPre(){let e=this.getConf("fastaLocation"),t=this.getConf("faiLocation");return{fasta:new s.BL({fasta:(0,o.openLocation)(e,this.pluginManager),fai:(0,o.openLocation)(t,this.pluginManager)})}}async getHeader(){let e=this.getConf("metadataLocation");return""===e.uri||"/path/to/fa.metadata.yaml"===e.uri?null:(0,o.openLocation)(e,this.pluginManager).readFile("utf8")}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(e=>{throw this.setupP=void 0,e})),this.setupP}getFeatures(e,t){let{statusCallback:a=()=>{},stopToken:n}=t||{},{refName:s,start:i,end:l}=e;return(0,c.ObservableCreate)(async e=>{await (0,r.updateStatus2)("Downloading sequence",a,n,async()=>{let{fasta:t}=await this.setup(),a=Math.min(await t.getSequenceSize(s),l),o=[],c=i-i%128e3,h=l+(128e3-l%128e3);for(let e=c;e<h;e+=128e3){let a={refName:s,start:e,end:e+128e3};(0,f.checkStopToken)(n),o.push(await this.seqCache.get(JSON.stringify(a),{...a,fasta:t}))}let u=o.filter(e=>!!e).join("").slice(i-c).slice(0,l-i);u&&e.next(new r.SimpleFeature({id:`${s}-${i}-${a}`,data:{refName:s,start:i,end:a,seq:u}}))}),e.complete()})}freeResources(){}}}}]);
//# sourceMappingURL=9430.3258b725efe8c6da.js.map