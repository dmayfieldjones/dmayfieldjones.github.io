"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2166],{42166:(e,t,i)=>{i.r(t),i.d(t,{default:()=>m});var n=i(95155),r=i(12115),s=i(47204),l=i(54262),a=i(23806),o=i(55089),c=i(9561),p=i(78443),u=i(19293),d=i(93929),h=i(21079),g=i.n(h),x=i(38003),y=i(2848);let f=(0,i(97771).makeStyles)()(e=>({textAreaFont:{fontFamily:"Courier New"},mgap:{display:"flex",flexDirection:"column",gap:e.spacing(4)}}));function m({model:e,handleClose:t}){let{classes:i}=f(),[h,m]=(0,r.useState)(),[j,v]=(0,r.useState)(),[w,A]=(0,r.useState)("");return(0,r.useEffect)(()=>{(async()=>{try{v(void 0);let t=(0,l.getContainingView)(e);if(!t.initialized)return;let{rpcManager:i}=(0,l.getSession)(e),{sources:n,minorAlleleFrequencyFilter:r,adapterConfig:s}=e,o=(0,a.getRpcSessionId)(e),c=await i.call(o,"MultiVariantGetGenotypeMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:n,minorAlleleFrequencyFilter:r,sessionId:o,adapterConfig:s}),p=Object.values(c),u=Object.keys(c),d=`try(library(fastcluster), silent=TRUE)
inputMatrix<-matrix(c(${p.map(e=>e.genotypes.join(",")).join(",\n")}
),nrow=${p.length},byrow=TRUE)
rownames(inputMatrix)<-c(${u.map(e=>`'${e}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='single')
cat(resultClusters$order,sep='\\n')`;m(d)}catch(t){!(0,l.isAbortException)(t)&&(0,y.isAlive)(e)&&(console.error(t),v(t))}})()},[e]),(0,n.jsxs)(s.Dialog,{open:!0,title:"Cluster by genotype",onClose:t,children:[(0,n.jsx)(o.A,{children:(0,n.jsxs)("div",{className:i.mgap,children:[(0,n.jsx)(c.A,{children:"This page will produce an R script that will perform hierarchical clustering on the visible genotype data using `hclust`."}),(0,n.jsx)(c.A,{children:"You can then paste the results in this form to specify the row ordering."}),h?(0,n.jsx)("div",{children:(0,n.jsxs)("div",{children:["Step 1:"," ",(0,n.jsx)(p.A,{variant:"contained",onClick:()=>{(0,x.saveAs)(new Blob([h||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,n.jsx)(p.A,{variant:"contained",onClick:()=>{g()(h||"")},children:"Copy Rscript to clipboard"}),(0,n.jsx)("div",{children:(0,n.jsx)(u.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Step 2. Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:w,onChange:e=>{A(e.target.value)},slotProps:{input:{classes:{input:i.textAreaFont}}}})})]})}):(0,n.jsx)(s.LoadingEllipses,{variant:"h6",title:"Generating genotype matrix"}),j?(0,n.jsx)(s.ErrorMessage,{error:j}):null]})}),(0,n.jsxs)(d.A,{children:[(0,n.jsx)(p.A,{disabled:!h,variant:"contained",onClick:()=>{let{sources:i}=e;if(i)try{e.setLayout(w.split("\n").map(e=>e.trim()).filter(e=>!!e).map(e=>+e).map(e=>{let t=i[e-1];if(!t)throw Error(`out of bounds at ${e}`);return t}))}catch(e){console.error(e),v(e)}t()},children:"Apply clustering"}),(0,n.jsx)(p.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})}}}]);
//# sourceMappingURL=2166.7887c122bc77dd72.js.map