"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1895],{21895:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var s=a(25927),r=a(31448),i=a(92766),n=a(54262),l=a(31177),c=a(72471),u=a(38378);class o extends i.BaseFeatureDataAdapter{constructor(){super(...arguments),this.calculatedIntervalTreeMap={}}async getHeader(){let{header:e}=await this.setup();return e}async getMetadata(){let{parser:e}=await this.setup();return e.getMetadata()}async setupP(e){let{statusCallback:t=()=>{}}=e||{},a=(0,l.openLocation)(this.getConf("vcfLocation"),this.pluginManager),i=await (0,n.fetchAndMaybeUnzip)(a,e),c=[],o={},p=0,h=new TextDecoder("utf8"),f=0;for(;p<i.length;){let e=i.indexOf(10,p),a=-1===e?i.subarray(p):i.subarray(p,e),s=h.decode(a).trim();if(s){if(s.startsWith("#"))c.push(s);else{let e=s.indexOf("	"),t=s.slice(0,e);o[t]||(o[t]=[]),o[t].push(s)}}f++%1e4==0&&t(`Loading ${Math.floor(p/1e6).toLocaleString("en-US")}/${Math.floor(i.length/1e6).toLocaleString("en-US")} MB`),p=e+1}let d=c.join("\n"),g=new r.A({header:d}),v=Object.fromEntries(Object.entries(o).map(([e,t])=>[e,a=>{if(!this.calculatedIntervalTreeMap[e]){null==a||a("Parsing VCF data");let r=0,i=new s.Ay;for(let a of t){let t=new u.A({variant:g.parseLine(a),parser:g,id:`${this.id}-${e}-${r++}`});i.insert([t.get("start"),t.get("end")],t)}this.calculatedIntervalTreeMap[e]=i}return this.calculatedIntervalTreeMap[e]}]));return{header:d,parser:g,intervalTreeMap:v}}async setup(){return this.vcfFeatures||(this.vcfFeatures=this.setupP().catch(e=>{throw this.vcfFeatures=void 0,e})),this.vcfFeatures}async getRefNames(e={}){let{intervalTreeMap:t}=await this.setup();return Object.keys(t)}getFeatures(e,t={}){return(0,c.ObservableCreate)(async a=>{var s;try{let{start:r,end:i,refName:n}=e,{intervalTreeMap:l}=await this.setup();null===(s=l[n])||void 0===s||s.call(l,t.statusCallback).search([r,i]).forEach(e=>{a.next(e)}),a.complete()}catch(e){a.error(e)}},t.stopToken)}async getSources(){let e=this.getConf("samplesTsvLocation");if(""===e.uri||"/path/to/samples.tsv"===e.uri){let{parser:e}=await this.setup();return e.samples.map(e=>({name:e}))}{let t=(await (0,l.openLocation)(e).readFile("utf8")).split(/\n|\r\n|\r/),a=t[0].split("	"),{parser:s}=await this.setup(),r=new Set(s.samples);return t.slice(1).map(e=>{let t=e.split("	");return{name:t[0],...Object.fromEntries(t.slice(1).map((e,t)=>[a[t+1],e]))}}).filter(e=>r.has(e.name))}}freeResources(){}}o.capabilities=["getFeatures","getRefNames"];let p=o}}]);
//# sourceMappingURL=1895.50f9595313d0dc97.js.map