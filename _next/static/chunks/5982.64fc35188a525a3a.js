"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5982],{31371:(e,t,a)=>{a.d(t,{tP:()=>c,BL:()=>l});var s=a(48559),n=a(29265);function i(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}async function r(e,t){return Object.fromEntries(new TextDecoder("utf8").decode(await e.readFile(t)).split(/\r?\n/).map(e=>e.trim()).filter(e=>!!e).map(e=>e.split("	")).map(e=>{if(e[0]?.startsWith(">"))throw Error("found > in sequence name, might have supplied FASTA file for the FASTA index");return[e[0],{name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}]}))}class l{constructor({fasta:e,fai:t,path:a,faiPath:n}){if(e)this.fasta=e;else if(a)this.fasta=new s.LocalFile(a);else throw Error("Need to pass filehandle for fasta or path to localfile");if(t)this.fai=t;else if(n)this.fai=new s.LocalFile(n);else if(a)this.fai=new s.LocalFile(`${a}.fai`);else throw Error("Need to pass filehandle for  or path to localfile")}async _getIndexes(e){return this.indexes||(this.indexes=r(this.fai,e).catch(e=>{throw this.indexes=void 0,e})),this.indexes}async getSequenceNames(e){return Object.keys(await this._getIndexes(e))}async getSequenceSizes(e){let t={};for(let a of Object.values(await this._getIndexes(e)))t[a.name]=a.length;return t}async getSequenceSize(e,t){let a=await this._getIndexes(t);return a[e]?.length}async hasReferenceSequence(e,t){return!!(await this._getIndexes(t))[e]}async getResiduesByName(e,t,a,s){let n=(await this._getIndexes(s))[e];return n?this._fetchFromIndexEntry(n,t,a,s):void 0}async getSequence(e,t,a,s){return this.getResiduesByName(e,t,a,s)}async _fetchFromIndexEntry(e,t=0,a,s){let n=a;if(t<0)throw TypeError("regionStart cannot be less than 0");if((void 0===n||n>e.length)&&(n=e.length),t>=n)return"";let r=i(e,t),l=i(e,n)-r;return new TextDecoder("utf8").decode(await this.fasta.read(l,r,s)).replace(/\s+/g,"")}}class c extends l{constructor({fasta:e,path:t,fai:a,faiPath:s,gzi:i,gziPath:r}){super({fasta:e,path:t,fai:a,faiPath:s}),e&&i?this.fasta=new n.BgzfFilehandle({filehandle:e,gziFilehandle:i}):t&&r&&(this.fasta=new n.BgzfFilehandle({path:t,gziPath:r}))}}},55982:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(28126),n=a(31371),i=a(92766),r=a(54262),l=a(61078),c=a(31177),o=a(72471),h=a(28251);class u extends i.BaseSequenceAdapter{constructor(){super(...arguments),this.seqCache=new s.A({cache:new l.default({maxSize:200}),fill:async e=>{let{refName:t,start:a,end:s,fasta:n}=e;return n.getSequence(t,a,s)}})}async getRefNames(e){let{fasta:t}=await this.setup();return t.getSequenceNames()}async getRegions(e){let{fasta:t}=await this.setup(),a=await t.getSequenceSizes();return Object.keys(a).map(e=>({refName:e,start:0,end:a[e]}))}async setupPre(){let e=this.getConf("fastaLocation"),t=this.getConf("faiLocation");return{fasta:new n.BL({fasta:(0,c.openLocation)(e,this.pluginManager),fai:(0,c.openLocation)(t,this.pluginManager)})}}async getHeader(){let e=this.getConf("metadataLocation");return""===e.uri||"/path/to/fa.metadata.yaml"===e.uri?null:(0,c.openLocation)(e,this.pluginManager).readFile("utf8")}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(e=>{throw this.setupP=void 0,e})),this.setupP}getFeatures(e,t){let{statusCallback:a=()=>{},stopToken:s}=t||{},{refName:n,start:i,end:l}=e;return(0,o.ObservableCreate)(async e=>{await (0,r.updateStatus2)("Downloading sequence",a,s,async()=>{let{fasta:t}=await this.setup(),a=Math.min(await t.getSequenceSize(n)||0,l),c=[],o=i-i%128e3,u=l+(128e3-l%128e3);for(let e=o;e<u;e+=128e3){let a={refName:n,start:e,end:e+128e3};(0,h.checkStopToken)(s),c.push(await this.seqCache.get(JSON.stringify(a),{...a,fasta:t}))}let f=c.filter(e=>!!e).join("").slice(i-o).slice(0,l-i);f&&e.next(new r.SimpleFeature({id:`${n}-${i}-${a}`,data:{refName:n,start:i,end:a,seq:f}}))}),e.complete()})}freeResources(){}}}}]);
//# sourceMappingURL=5982.64fc35188a525a3a.js.map