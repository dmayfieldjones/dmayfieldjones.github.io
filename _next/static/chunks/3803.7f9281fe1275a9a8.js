"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3803],{3803:(t,e,a)=>{a.r(e),a.d(e,{getQuantitativeStatsAutorun:()=>u});var i=a(54262),s=a(28251),l=a(37725),n=a(2848),r=a(53394),o=a(23806);async function c(t,e){let{rpcManager:a}=(0,i.getSession)(t),s=(0,r.getConf)(t,"numStdDev")||3,{adapterConfig:l,autoscaleType:c}=t,u=(0,o.getRpcSessionId)(t),{currStatsBpPerPx:g}=e,d={sessionId:u,adapterConfig:l,statusCallback:e=>{(0,n.isAlive)(t)&&t.setMessage(e)},...e};if("global"===c||"globalsd"===c){let t=await a.call(u,"WiggleGetGlobalQuantitativeStats",d),{scoreMin:e,scoreMean:i,scoreStdDev:l}=t;return"globalsd"===c?{...t,scoreMin:e>=0?0:i-s*l,scoreMax:i+s*l,currStatsBpPerPx:g}:{...t,currStatsBpPerPx:g}}if("local"===c||"localsd"===c){let{dynamicBlocks:e,bpPerPx:l}=(0,i.getContainingView)(t),n=await a.call(u,"WiggleGetMultiRegionQuantitativeStats",{...d,regions:e.contentBlocks.map(t=>{let{start:e,end:a}=t;return{...JSON.parse(JSON.stringify(t)),start:Math.floor(e),end:Math.ceil(a)}}),bpPerPx:l}),{scoreMin:r,scoreMean:o,scoreStdDev:p}=n;return"localsd"===c?{...n,scoreMin:r>=0?0:o-s*p,scoreMax:o+s*p,currStatsBpPerPx:g}:{...n,currStatsBpPerPx:g}}if("zscale"===c)return a.call(u,"WiggleGetGlobalQuantitativeStats",d);throw Error(`invalid autoscaleType '${c}'`)}function u(t){(0,n.addDisposer)(t,(0,l.autorun)(async()=>{try{if(t.quantitativeStatsReady){let e=(0,i.getContainingView)(t),a=(0,s.createStopToken)();t.setStatsLoading(a);let l=JSON.stringify(e.dynamicBlocks),r=await c(t,{stopToken:a,filters:[],currStatsBpPerPx:e.bpPerPx,...t.adapterProps()});(0,n.isAlive)(t)&&t.updateQuantitativeStats(r,l)}}catch(e){(0,n.isAlive)(t)&&!(0,i.isAbortException)(e)&&(console.error(e),t.setError(e))}},{delay:1e3}))}}}]);
//# sourceMappingURL=3803.7f9281fe1275a9a8.js.map