"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3477],{53477:(e,t,o)=>{o.d(t,{makeImage:()=>c});var l=o(88753),n=o(94029),r=o(15715),i=o(64294),a=o(25364),s=o(68821);let f={C:"G",G:"C",A:"T",T:"A"};async function c(e,t){var o,c,d,p,b,y,h,u,v,k;let{features:m,regions:g,bpPerPx:S,colorBy:T,displayCrossHatches:w,visibleModifications:C={},scaleOpts:O,height:D,theme:_,config:j,ticks:M,stopToken:N}=t,R=(0,n.createJBrowseTheme)(_),P=g[0],x=(P.end-P.start)/S,A=a.Oy,G=D-2*A,I={...O,range:[0,G]},$=(0,a.X_)(I),z=(0,a.X_)({...I,range:[0,G/2],scaleType:"linear"}),E=(0,a.$z)(O.scaleType),W=(0,a.$z)("linear"),X=(0,l.readConfObject)(j,"indicatorThreshold"),B=(0,l.readConfObject)(j,"showInterbaseCounts"),J=(0,l.readConfObject)(j,"showArcs"),U=(0,l.readConfObject)(j,"showInterbaseIndicators"),q=e=>G-($(e)||0)+A,F=e=>q(E)-q(e),H=e=>G-(z(e)||0)+A,K=e=>H(W)-H(e),{bases:L,softclip:Q,hardclip:V,insertion:Y}=R.palette,Z={A:L.A.main,C:L.C.main,G:L.G.main,T:L.T.main,insertion:Y,softclip:Q,hardclip:V,total:(0,l.readConfObject)(j,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"},ee=[...m.values()];e.fillStyle=Z.total;let et=performance.now();for(let t of ee){if("skip"===t.get("type"))continue;let[o,l]=(0,r.featureSpanPx)(t,P,S),n=l-o+.6,a=t.get("score");e.fillRect(o,q(a),n,F(a)),performance.now()-et>400&&((0,i.checkStopToken)(N),et=performance.now())}let eo=0,el=P.reversed?1/S:0,en="modifications"===T.type,er="methylation"===T.type,ei=null===(o=T.modifications)||void 0===o?void 0:o.isolatedModification;for(let t of(et=performance.now(),ee)){if(performance.now()-et>400&&(0,i.checkStopToken)(N),"skip"===t.get("type"))continue;let[o,l]=(0,r.featureSpanPx)(t,P,S),n=t.get("snpinfo"),a=Math.max(l-o,1),m=t.get("score");if(en){let t=0,l=null===(c=n.refbase)||void 0===c?void 0:c.toUpperCase(),{nonmods:r,mods:i,snps:g,ref:S}=n;for(let i of Object.keys(r).sort().reverse()){let r=C[i.replace("nonmod_","")]||C[i.replace("mod_","")];if(!r){console.warn(`${i} not known yet`);continue}if(ei&&r.type!==ei)continue;let c=f[r.base],h="N"===r.base?m:((null===(d=g[r.base])||void 0===d?void 0:d.entryDepth)||0)+((null===(p=g[c])||void 0===p?void 0:p.entryDepth)||0)+(l===r.base?S["1"]:0)+(l===c?S["-1"]:0),u="N"===r.base?m:((null===(b=g[r.base])||void 0===b?void 0:b.entryDepth)||0)+((null===(y=g[c])||void 0===y?void 0:y.entryDepth)||0)+(l===r.base?S.entryDepth:0)+(l===c?S.entryDepth:0),{entryDepth:v,avgProbability:k=0}=n.nonmods[i],T=u/m*(v/h),w=(0,s.yr)("blue",k),O=F(m),D=q(m)+O;e.fillStyle=w,e.fillRect(Math.round(o),D-(t+T*O),a,T*O),t+=T*O}for(let n of Object.keys(i).sort().reverse()){let r=C[n.replace("mod_","")];if(!r){console.warn(`${n} not known yet`);continue}if(ei&&r.type!==ei)continue;let c=f[r.base],d="N"===r.base?m:((null===(h=g[r.base])||void 0===h?void 0:h.entryDepth)||0)+((null===(u=g[c])||void 0===u?void 0:u.entryDepth)||0)+(l===r.base?S["1"]:0)+(l===c?S["-1"]:0),p="N"===r.base?m:((null===(v=g[r.base])||void 0===v?void 0:v.entryDepth)||0)+((null===(k=g[c])||void 0===k?void 0:k.entryDepth)||0)+(l===r.base?S.entryDepth:0)+(l===c?S.entryDepth:0),{entryDepth:b,avgProbability:y=0}=i[n],T=p/m*(b/d),w=r.color||"black",O=(0,s.yr)(w,y),D=F(m),_=q(m)+D;e.fillStyle=O,e.fillRect(Math.round(o),_-(t+T*D),a,T*D),t+=T*D}}else if(er){let{depth:t,nonmods:l,mods:r}=n,i=0;for(let l of Object.keys(r).sort().reverse()){let{entryDepth:n}=r[l],s=F(m),f=q(m)+s;e.fillStyle=Z[l]||"black",e.fillRect(Math.round(o),f-(n+i)/t*s,a,n/t*s),i+=n}for(let n of Object.keys(l).sort().reverse()){let{entryDepth:r}=l[n],s=F(m),f=q(m)+s;e.fillStyle=Z[n]||"black",e.fillRect(Math.round(o),f-(r+i)/t*s,a,r/t*s),i+=r}}else{let{depth:t,snps:l}=n,r=0;for(let n of Object.keys(l).sort().reverse()){let{entryDepth:i}=l[n],s=F(m),f=q(m)+s;e.fillStyle=Z[n]||"black",e.fillRect(Math.round(o),f-(i+r)/t*s,a,i/t*s),r+=i}}let g=Object.keys(n.noncov);if(B){let t=0;for(let l of g){let{entryDepth:r}=n.noncov[l];e.fillStyle=Z[l],e.fillRect(o-.6+el,4.5+K(t),1.2,K(r)),t+=r}}if(U){let t=0,l=0,r="";for(let e of g){let{entryDepth:o}=n.noncov[e];t+=o,o>l&&(l=o,r=e)}let i=Math.max(m,eo);if(t>i*X&&i>7){e.fillStyle=Z[r],e.beginPath();let t=o+el;e.moveTo(t-3.5,0),e.lineTo(t+3.5,0),e.lineTo(t,4.5),e.fill()}}eo=m}if(J)for(let t of ee){if("skip"!==t.get("type"))continue;let o=t.get("start"),l=t.get("end"),[n,i]=(0,r.bpSpanPx)(o,l,P,S);e.beginPath();let a=t.get("effectiveStrand");1===a?e.strokeStyle="rgba(255,200,200,0.7)":-1===a?e.strokeStyle="rgba(200,200,255,0.7)":e.strokeStyle="rgba(200,200,200,0.7)",e.lineWidth=Math.log(t.get("score")+1),e.moveTo(n,G-2*A),e.bezierCurveTo(n,0,i,0,i,G-2*A),e.stroke()}if(w)for(let t of(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",M.values))e.beginPath(),e.moveTo(0,Math.round(q(t))),e.lineTo(x,Math.round(q(t))),e.stroke()}}}]);
//# sourceMappingURL=3477.f2d350add8c3d8eb.js.map