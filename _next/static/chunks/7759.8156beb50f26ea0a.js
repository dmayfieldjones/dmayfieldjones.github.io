"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7759],{46882:(e,t,a)=>{a.d(t,{L$:()=>b,qe:()=>C});var i=a(95155),n=a(12115),o=a(94029),r=a(64150),s=a(96358),l=a(66292),d=a(19468),c=a(51539),p=a(54102),f=a(59886);let m=(0,a(74100).makeStyles)()({block:{display:"block"}});function w({checked:e,disabled:t,label:a,onChange:n}){let{classes:o}=m();return(0,i.jsx)(p.A,{disabled:t,className:o.block,control:(0,i.jsx)(f.A,{checked:e,onChange:n}),label:a})}var v=a(15715),h=a(86168);function u({feature:e,assembly:t}){var a;let i=null===(a=e.get("ALT"))||void 0===a?void 0:a[0],n=i?(0,h.h)(i):void 0,o=e.get("start"),r=e.get("refName"),s=e=>t.getCanonicalRefName(e)||e;if("<TRA>"===i){let t=e.get("INFO");return{pos:o,refName:s(r),mateRefName:s(t.CHR2[0]),matePos:t.END[0]-1}}if(null==n?void 0:n.MatePosition){let e=n.MatePosition.split(":");return{pos:o,refName:s(r),mateRefName:s(e[0]),matePos:+e[1]-1}}if(!e.get("mate"))return{pos:o,refName:s(r),mateRefName:s(r),matePos:e.get("end")};{let t=e.get("mate");return{pos:o,refName:s(r),mateRefName:s(t.refName),matePos:t.start}}}function g(e){return e.map(({id:e,displays:t,...a})=>({...a,displays:t.map(({id:e,...t})=>t)}))}function y(e){return`${e.get("name")||e.get("id")||"breakend"} split detail`}async function k({stableViewId:e,feature:t,assemblyName:a,session:i,mirror:n,tracks:o=[]}){let{assemblyManager:r}=i,s=await r.waitForAssembly(a);if(!s)throw Error(`assembly ${a} not found`);let{refName:l,pos:d,mateRefName:c,matePos:p}=u({feature:t,assembly:s}),f=i.views.find(t=>t.id===e);f||(f=i.addView("BreakpointSplitView",{id:e,type:"BreakpointSplitView",displayName:y(t),views:[{type:"LinearGenomeView",hideHeader:!0,tracks:g(o)},{type:"LinearGenomeView",hideHeader:!0,tracks:g(n?[...o].reverse():o)}]})),f.setDisplayName(y(t));let m=s.regions.find(e=>e.refName===l),w=s.regions.find(e=>e.refName===c);if(!m||!w)throw Error("can't find regions");await Promise.all([f.views[0].navToLocations([{refName:l,start:m.start,end:d,assemblyName:a},{refName:l,start:d+1,end:m.end,assemblyName:a}]),f.views[1].navToLocations([{refName:c,start:w.start,end:p,assemblyName:a},{refName:c,start:p+1,end:w.end,assemblyName:a}])]),await (0,v.when)(()=>f.views[1].initialized&&f.views[0].initialized),f.views[1].zoomTo(10),f.views[0].zoomTo(10),f.views[1].centerAt(p,c),f.views[0].centerAt(d,l)}let b=(0,d.observer)(function({session:e,handleClose:t,feature:a,assemblyName:d,stableViewId:p,view:f}){let[m,v]=(0,n.useState)(!0),[h,u]=(0,n.useState)(!0);return(0,i.jsxs)(o.Dialog,{open:!0,onClose:t,title:"Multi-level breakpoint split view options",children:[(0,i.jsxs)(r.A,{children:[(0,i.jsx)("div",{children:"Launch multi-level breakpoint split view"}),f?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w,{checked:m,label:"Copy tracks into the new view",onChange:e=>{v(e.target.checked)}}),m?(0,i.jsx)(w,{checked:h,disabled:!m,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:e=>{u(e.target.checked)}}):null]}):null]}),(0,i.jsxs)(s.A,{children:[(0,i.jsx)(l.A,{onClick:()=>{(async()=>{try{await k({stableViewId:p,session:e,tracks:m&&f?(0,c.getSnapshot)(f.tracks):[],mirror:h,feature:a,assemblyName:d})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,i.jsx)(l.A,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})});var N=a(95946);async function x({stableViewId:e,feature:t,assemblyName:a,session:i,tracks:n,windowSize:o=0,focusOnBreakends:r}){var s;let{snap:l,coverage:d}=r?function({feature:e,session:t,assemblyName:a,windowSize:i=0}){let{assemblyManager:n}=t,o=n.get(a);if(!o)throw Error(`assembly ${a} not found`);if(!o.regions)throw Error(`assembly ${a} regions not loaded`);let r=u({feature:e,assembly:o}),{refName:s,mateRefName:l}=r,d=o.regions.find(e=>e.refName===s),c=o.regions.find(e=>e.refName===l);return{coverage:r,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,v.gatherOverlaps)([{...d,end:r.pos+i,assemblyName:a},{...c,start:r.matePos-i,assemblyName:a}])}],displayName:y(e)}}}({feature:t,assemblyName:a,session:i,windowSize:o}):function({feature:e,session:t,assemblyName:a}){let{assemblyManager:i}=t,n=i.get(a);if(!n)throw Error(`assembly ${a} not found`);if(!n.regions)throw Error(`assembly ${a} regions not loaded`);let o=u({feature:e,assembly:n}),{refName:r,mateRefName:s}=o,l=n.regions.find(e=>e.refName===r),d=n.regions.find(e=>e.refName===s);return{coverage:o,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:(0,v.gatherOverlaps)([{...l,assemblyName:a},{...d,assemblyName:a}])}],displayName:y(e)}}}({feature:t,assemblyName:a,session:i}),{refName:p,pos:f,mateRefName:m,matePos:w}=d,h=i.views.find(t=>t.id===e);h?(null===(s=h.views[0])||void 0===s||s.setDisplayedRegions(l.views[0].displayedRegions),h.setDisplayName(l.displayName)):h=i.addView("BreakpointSplitView",{...l,views:[{...l.views[0],tracks:n?g((0,c.getSnapshot)(n)):[]}]});let k=h.views[0];await (0,v.when)(()=>k.initialized);let b=k.bpToPx({coord:Math.max(0,f-o),refName:p}),N=k.bpToPx({coord:w+o,refName:m});b&&N?k.moveTo({...b,offset:b.offsetPx},{...N,offset:N.offsetPx}):(0,v.getSession)(k).notify("Unable to navigate to breakpoint")}let C=(0,d.observer)(function({session:e,handleClose:t,feature:a,stableViewId:d,assemblyName:c,view:p}){let[f,m]=(0,n.useState)(!0),[h,u]=(0,n.useState)(!0),[g,y]=(0,v.useLocalStorage)("breakpointWindowSize","5000");return(0,i.jsxs)(o.Dialog,{open:!0,onClose:t,title:"Single-level breakpoint split view options",children:[(0,i.jsxs)(r.A,{children:[p?(0,i.jsx)(w,{checked:f,label:"Copy tracks into the new view",onChange:e=>{m(e.target.checked)}}):null,(0,i.jsx)(w,{checked:f,label:"Focus on breakends",onChange:e=>{u(e.target.checked)}}),(0,i.jsx)(N.A,{label:"Window size (bp)",value:g,onChange:e=>{y(e.target.value)}})]}),(0,i.jsxs)(s.A,{children:[(0,i.jsx)(l.A,{onClick:()=>{(async()=>{try{let{assemblyManager:t}=e;if(!await t.waitForAssembly(c))throw Error(`assembly ${c} not found`);await x({feature:a,assemblyName:c,focusOnBreakends:h,session:e,stableViewId:d,tracks:null==p?void 0:p.tracks,windowSize:+g||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),t()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),(0,i.jsx)(l.A,{color:"secondary",variant:"contained",onClick:()=>{t()},children:"Cancel"})]})]})})},47759:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i.L$});var i=a(46882)}}]);
//# sourceMappingURL=7759.8156beb50f26ea0a.js.map