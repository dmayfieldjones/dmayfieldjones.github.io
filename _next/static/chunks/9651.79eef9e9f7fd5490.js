"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9651],{99651:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var n=s(95155),i=s(12115),l=s(94029),r=s(83636),a=s(54102),o=s(81852),c=s(19468),d=s(15715),u=s(64294),p=s(70473),x=s(64150),h=s(66292),g=s(9670),j=s(95946),v=s(96358),m=s(51539);let b=(0,c.observer)(function({model:e,children:t,handleClose:s}){let[r,a]=(0,i.useState)(""),[o,c]=(0,i.useState)(),[b,f]=(0,i.useState)(""),[A,y]=(0,i.useState)(!1),[C,S]=(0,d.useLocalStorage)("cluster-samplesPerPixel","1");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(x.A,{children:[t,(0,n.jsxs)("div",{style:{marginTop:50},children:[(0,n.jsx)(h.A,{variant:"contained",onClick:()=>{y(!A)},children:A?"Hide advanced options":"Show advanced options"}),A?(0,n.jsxs)("div",{style:{marginTop:20},children:[(0,n.jsx)(g.A,{children:"This procedure samples the data at each 'pixel' across the visible by default"}),(0,n.jsx)(j.A,{label:"Samples per pixel (>1 for denser sampling, between 0-1 for sparser sampling)",variant:"outlined",size:"small",value:C,onChange:e=>{S(e.target.value)}})]}):null]}),(0,n.jsxs)("div",{children:[r?(0,n.jsxs)("div",{style:{padding:50},children:[(0,n.jsxs)("span",{style:{width:400},children:["Progress: ",r]}),(0,n.jsx)(h.A,{onClick:()=>{(0,u.stopStopToken)(b)},children:"Stop"})]}):null,o?(0,n.jsx)(l.ErrorMessage,{error:o}):null]})]}),(0,n.jsxs)(v.A,{children:[(0,n.jsx)(h.A,{variant:"contained",onClick:async()=>{try{c(void 0),a("");let t=(0,d.getContainingView)(e);if(!t.initialized)return;let{rpcManager:n}=(0,d.getSession)(e),{sourcesWithoutLayout:i,adapterConfig:l}=e;if(i){let s=(0,p.getRpcSessionId)(e),r=(0,u.createStopToken)();f(r);let o=await n.call(s,"MultiWiggleClusterScoreMatrix",{regions:t.dynamicBlocks.contentBlocks,sources:i,sessionId:s,adapterConfig:l,stopToken:r,bpPerPx:t.bpPerPx/+C,statusCallback:e=>{a(e)}});e.setLayout(o.order.map(e=>{let t=i[e];if(!t)throw Error(`out of bounds at ${e}`);return t}))}s()}catch(t){!(0,d.isAbortException)(t)&&(0,m.isAlive)(e)&&(console.error(t),c(t))}finally{a(""),f("")}},children:"Run clustering"}),(0,n.jsx)(h.A,{variant:"contained",color:"secondary",onClick:()=>{s(),b&&(0,u.stopStopToken)(b)},children:"Cancel"})]})]})});var f=s(98167),A=s(69068),y=s.n(A),C=s(91540);let S=(0,s(74100).makeStyles)()(e=>({textAreaFont:{fontFamily:"Courier New"},mgap:{display:"flex",flexDirection:"column",gap:e.spacing(4)}})),k=(0,c.observer)(function({model:e,handleClose:t,children:s}){let{classes:c}=S(),[u,b]=(0,i.useState)(""),[A,k]=(0,i.useState)(),[w,M]=(0,i.useState)(),[P,E]=(0,i.useState)(!1),[T,R]=(0,i.useState)(!1),[$,B]=(0,d.useLocalStorage)("cluster-clusterMethod","single"),[L,O]=(0,d.useLocalStorage)("cluster-samplesPerPixel","1");(0,i.useEffect)(()=>{(async()=>{try{M(void 0),k(void 0),E(!0);let{dynamicBlocks:t,bpPerPx:s}=(0,d.getContainingView)(e),{rpcManager:n}=(0,d.getSession)(e),{sourcesWithoutLayout:i,adapterConfig:l}=e,r=(0,p.getRpcSessionId)(e),a=await n.call(r,"MultiWiggleGetScoreMatrix",{regions:t.contentBlocks,sources:i,sessionId:r,adapterConfig:l,bpPerPx:s/+L});k(a)}catch(t){!(0,d.isAbortException)(t)&&(0,m.isAlive)(e)&&(console.error(t),M(t))}finally{E(!1)}})()},[e,L]);let D=A?`inputMatrix<-matrix(c(${Object.values(A).map(e=>e.join(",")).join(",\n")}
),nrow=${Object.values(A).length},byrow=TRUE)
rownames(inputMatrix)<-c(${Object.keys(A).map(e=>`'${e}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='${$}')
cat(resultClusters$order,sep='\\n')`:void 0,F=A?Object.entries(A).map(([e,t])=>[e,...t].join("	")).join("\n"):void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(x.A,{children:[s,(0,n.jsxs)("div",{style:{marginTop:50},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"16px"},children:[(0,n.jsx)(h.A,{variant:"contained",onClick:()=>{(0,C.saveAs)(new Blob([D||""],{type:"text/plain;charset=utf-8"}),"cluster.R")},children:"Download Rscript"})," ","or"," ",(0,n.jsx)(h.A,{variant:"contained",onClick:()=>{y()(D||"")},children:"Copy Rscript to clipboard"})," ",(0,n.jsx)("div",{style:{float:"right"},children:(0,n.jsx)(l.CascadingMenuButton,{menuItems:[{label:"Download TSV",onClick:()=>{(0,C.saveAs)(new Blob([F||""],{type:"text/plain;charset=utf-8"}),"scores.tsv")}},{label:T?"Hide advanced options":"Show advanced options",onClick:()=>{R(!T)}}],children:(0,n.jsx)(f.A,{})})}),(0,n.jsx)("div",{children:T?(0,n.jsxs)("div",{children:[(0,n.jsx)(g.A,{variant:"h6",children:"Advanced options"}),(0,n.jsx)(r.A,{children:Object.entries({single:"Single",complete:"Complete"}).map(([e,t])=>(0,n.jsx)(a.A,{control:(0,n.jsx)(o.A,{checked:$===e,onChange:()=>{B(e)}}),label:t},e))}),(0,n.jsxs)("div",{style:{marginTop:20},children:[(0,n.jsx)(g.A,{children:"This procedure samples the data at each 'pixel' across the visible by default"}),(0,n.jsx)(j.A,{label:"Samples per pixel (>1 for denser sampling, between 0-1 for sparser sampling)",variant:"outlined",size:"small",value:L,onChange:e=>{O(e.target.value)}})]})]}):null}),D?(0,n.jsx)("div",{}):P?(0,n.jsx)(l.LoadingEllipses,{variant:"h6",title:"Generating score matrix"}):w?(0,n.jsx)(l.ErrorMessage,{error:w}):null]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(g.A,{variant:"subtitle2",gutterBottom:!0,style:{marginTop:"16px"},children:"Clustering Results:"}),(0,n.jsx)(j.A,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:u,onChange:e=>{b(e.target.value)},slotProps:{input:{classes:{input:c.textAreaFont}}}})]})]})]}),(0,n.jsxs)(v.A,{children:[(0,n.jsx)(h.A,{variant:"contained",onClick:()=>{let{sourcesWithoutLayout:s}=e;if(s)try{e.setLayout(u.split("\n").map(e=>e.trim()).filter(e=>!!e).map(e=>+e).map(e=>{let t=s[e-1];if(!t)throw Error(`out of bounds at ${e}`);return t}))}catch(t){console.error(t),(0,d.getSession)(e).notifyError(`${t}`,t)}t()},children:"Apply clustering"}),(0,n.jsx)(h.A,{variant:"contained",color:"secondary",onClick:()=>{t()},children:"Cancel"})]})]})});function w({activeMode:e,setActiveMode:t}){return(0,n.jsx)("div",{children:(0,n.jsx)(r.A,{children:Object.entries({auto:(0,n.jsx)("div",{children:"Run in-app clustering (slow for large data, built in JS clustering)"}),manual:(0,n.jsx)("div",{children:"Download R script to run clustering (faster for large data, uses hclust, may be more accurate)"})}).map(([s,i])=>(0,n.jsx)(a.A,{control:(0,n.jsx)(o.A,{checked:e===s,onChange:()=>{t(s)}}),label:i},s))})})}let M=(0,c.observer)(function({model:e,handleClose:t}){let[s,r]=(0,i.useState)("auto");return(0,n.jsx)(l.Dialog,{open:!0,title:"Cluster by score",maxWidth:"xl",onClose:(e,s)=>{"backdropClick"!==s&&t()},children:"auto"===s?(0,n.jsx)(b,{model:e,handleClose:t,children:(0,n.jsx)(w,{activeMode:s,setActiveMode:r})}):(0,n.jsx)(k,{model:e,handleClose:t,children:(0,n.jsx)(w,{activeMode:s,setActiveMode:r})})})})}}]);
//# sourceMappingURL=9651.79eef9e9f7fd5490.js.map