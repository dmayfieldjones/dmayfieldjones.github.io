"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5959,8327],{18327:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var n=a(3273),s=a(21192),i=a(29269),r=a(15715),o=a(15369),l=a(64446),c=a(31232),h=a(64294);class u extends i.BaseSequenceAdapter{constructor(){super(...arguments),this.seqCache=new n.A({cache:new o.default({maxSize:200}),fill:async e=>{let{refName:t,start:a,end:n,fasta:s}=e;return s.getSequence(t,a,n)}})}async getRefNames(e){let{fasta:t}=await this.setup();return t.getSequenceNames()}async getRegions(e){let{fasta:t}=await this.setup(),a=await t.getSequenceSizes();return Object.keys(a).map(e=>({refName:e,start:0,end:a[e]}))}async setupPre(){let e=this.getConf("fastaLocation"),t=this.getConf("faiLocation");return{fasta:new s.BL({fasta:(0,l.openLocation)(e,this.pluginManager),fai:(0,l.openLocation)(t,this.pluginManager)})}}async getHeader(){let e=this.getConf("metadataLocation");return""===e.uri||"/path/to/fa.metadata.yaml"===e.uri?null:(0,l.openLocation)(e,this.pluginManager).readFile("utf8")}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(e=>{throw this.setupP=void 0,e})),this.setupP}getFeatures(e,t){let{statusCallback:a=()=>{},stopToken:n}=t||{},{refName:s,start:i,end:o}=e;return(0,c.ObservableCreate)(async e=>{await (0,r.updateStatus2)("Downloading sequence",a,n,async()=>{let{fasta:t}=await this.setup(),a=Math.min(await t.getSequenceSize(s)||0,o),l=[],c=i-i%128e3,u=o+(128e3-o%128e3);for(let e=c;e<u;e+=128e3){let a={refName:s,start:e,end:e+128e3};(0,h.checkStopToken)(n),l.push(await this.seqCache.get(JSON.stringify(a),{...a,fasta:t}))}let f=l.filter(e=>!!e).join("").slice(i-c).slice(0,o-i);f&&e.next(new r.SimpleFeature({id:`${s}-${i}-${a}`,data:{refName:s,start:i,end:a,seq:f}}))}),e.complete()})}freeResources(){}}},21192:(e,t,a)=>{a.d(t,{tP:()=>l,BL:()=>o});var n=a(98135),s=a(71654);function i(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}async function r(e,t){return Object.fromEntries(new TextDecoder("utf8").decode(await e.readFile(t)).split(/\r?\n/).map(e=>e.trim()).filter(e=>!!e).map(e=>e.split("	")).map(e=>{if(e[0]?.startsWith(">"))throw Error("found > in sequence name, might have supplied FASTA file for the FASTA index");return[e[0],{name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}]}))}class o{constructor({fasta:e,fai:t,path:a,faiPath:s}){if(e)this.fasta=e;else if(a)this.fasta=new n.LocalFile(a);else throw Error("Need to pass filehandle for fasta or path to localfile");if(t)this.fai=t;else if(s)this.fai=new n.LocalFile(s);else if(a)this.fai=new n.LocalFile(`${a}.fai`);else throw Error("Need to pass filehandle for  or path to localfile")}async _getIndexes(e){return this.indexes||(this.indexes=r(this.fai,e).catch(e=>{throw this.indexes=void 0,e})),this.indexes}async getSequenceNames(e){return Object.keys(await this._getIndexes(e))}async getSequenceSizes(e){let t={};for(let a of Object.values(await this._getIndexes(e)))t[a.name]=a.length;return t}async getSequenceSize(e,t){let a=await this._getIndexes(t);return a[e]?.length}async hasReferenceSequence(e,t){return!!(await this._getIndexes(t))[e]}async getResiduesByName(e,t,a,n){let s=(await this._getIndexes(n))[e];return s?this._fetchFromIndexEntry(s,t,a,n):void 0}async getSequence(e,t,a,n){return this.getResiduesByName(e,t,a,n)}async _fetchFromIndexEntry(e,t=0,a,n){let s=a;if(t<0)throw TypeError("regionStart cannot be less than 0");if((void 0===s||s>e.length)&&(s=e.length),t>=s)return"";let r=i(e,t),o=i(e,s)-r;return new TextDecoder("utf8").decode(await this.fasta.read(o,r,n)).replace(/\s+/g,"")}}class l extends o{constructor({fasta:e,path:t,fai:a,faiPath:n,gzi:i,gziPath:r}){super({fasta:e,path:t,fai:a,faiPath:n}),e&&i?this.fasta=new s.BgzfFilehandle({filehandle:e,gziFilehandle:i}):t&&r&&(this.fasta=new s.BgzfFilehandle({path:t,gziPath:r}))}}},95959:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});var n=a(21192),s=a(64446),i=a(18327);class r extends i.default{async setupPre(){let e=this.getConf("fastaLocation"),t=this.getConf("faiLocation"),a=this.getConf("gziLocation"),i={fasta:(0,s.openLocation)(e,this.pluginManager),fai:(0,s.openLocation)(t,this.pluginManager),gzi:(0,s.openLocation)(a,this.pluginManager)};return{fasta:new n.tP(i)}}}}}]);
//# sourceMappingURL=5959.a567e87b77ec8d8d.js.map