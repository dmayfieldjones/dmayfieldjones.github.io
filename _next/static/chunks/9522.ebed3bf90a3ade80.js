"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9522],{79522:(e,t,r)=>{r.d(t,{C:()=>x,j:()=>y});let i=BigInt(32);"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(e,t){return function(e,t,r){let a=Number(!!r),n=Number(!r);return BigInt(e.getInt32(t,r)*n+e.getInt32(t+4,r)*a)<<i|BigInt(e.getUint32(t,r)*a+e.getUint32(t+4,r)*n)}(this,e,t)}),"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(e,t){return function(e,t,r){let a=e.getUint32(t,r),n=e.getUint32(t+4,r),l=Number(!!r),s=Number(!r);return BigInt(a*s+n*l)<<i|BigInt(a*l+n*s)}(this,e,t)});var a=r(28126),n=r(68134),l=r.n(n);class s{constructor(e){this.ranges=e}get min(){return this.ranges[0].min}get max(){return this.ranges.at(-1).max}contains(e){for(let t of this.ranges)if(t.min<=e&&t.max>=e)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map(e=>new s([{min:e.min,max:e.max}]))}toString(){return this.ranges.map(e=>`[${e.min}-${e.max}]`).join(",")}union(e){let t=[...this.getRanges(),...e.getRanges()].sort((e,t)=>e.min<t.min?-1:e.min>t.min?1:e.max<t.max?-1:t.max>e.max?1:0),r=[],i=t[0];for(let e of t)e.min>i.max+1?(r.push(i),i=e):e.max>i.max&&(i=new s([{min:i.min,max:e.max}]));return r.push(i),1===r.length?r[0]:new s(r)}}var g=r(71437);class o extends Error{constructor(e){super(e),this.code="ERR_ABORTED"}}function f(e){if(e&&e.aborted){if("undefined"==typeof DOMException){let e=new o("aborted");throw e.code="ERR_ABORTED",e}throw new DOMException("aborted","AbortError")}}let u="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;class h{constructor(e,t,r,i,n){if(this.bbi=e,this.refsByName=t,this.cirTreeOffset=r,this.isCompressed=i,this.blockType=n,this.featureCache=new a.A({cache:new(l())({maxSize:1e3}),fill:async(e,t)=>this.bbi.read(e.length,e.offset,{signal:t})}),!(r>=0))throw Error("invalid cirTreeOffset!")}async readWigData(e,t,r,i,a){try{let{refsByName:n,bbi:l,cirTreeOffset:g}=this,o=n[e];void 0===o&&i.complete();let f={chrId:o,start:t,end:r};this.cirTreePromise||(this.cirTreePromise=l.read(48,g,a));let u=await this.cirTreePromise,h=new DataView(u.buffer).getUint32(4,!0),c=[],b=0,m=(e,t,r)=>{try{let i=e.subarray(t),a=new DataView(i.buffer,i.byteOffset,i.length),n=0,l=a.getUint8(n);n+=2;let s=a.getUint16(n,!0);if(n+=2,1===l){let e=[];for(let t=0;t<s;t++){let t=a.getUint32(n,!0);n+=4;let r=a.getUint32(n,!0);n+=4;let i=a.getUint32(n,!0);n+=4;let l=a.getUint32(n,!0);n+=4;let s=Number(a.getBigUint64(n,!0));n+=8;let g=Number(a.getBigUint64(n,!0));n+=8,e.push({startChrom:t,startBase:r,endBase:l,endChrom:i,blockOffset:s,blockSize:g,offset:n})}c=c.concat(e.filter(e=>d(e)).map(e=>({offset:e.blockOffset,length:e.blockSize})))}else if(0===l){let e=[];for(let t=0;t<s;t++){let t=a.getUint32(n,!0);n+=4;let r=a.getUint32(n,!0);n+=4;let i=a.getUint32(n,!0);n+=4;let l=a.getUint32(n,!0);n+=4;let s=Number(a.getBigUint64(n,!0));n+=8,e.push({startChrom:t,startBase:r,endChrom:i,endBase:l,blockOffset:s,offset:n})}let t=e.filter(e=>d(e)).map(e=>e.blockOffset);t.length>0&&y(t,r+1)}}catch(e){i.error(e)}},d=e=>{let{startChrom:i,startBase:a,endChrom:n,endBase:l}=e;return(i<o||i===o&&a<=r)&&(n>o||n===o&&l>=t)},w=async(e,t,r)=>{try{let n=t.max-t.min,l=t.min,s=await this.featureCache.get(`${n}_${l}`,{length:n,offset:l},a?.signal);for(let n of e)t.contains(n)&&(m(s,n-l,r),b-=1,0===b&&this.readFeatures(i,c,{...a,request:f}).catch(e=>{i.error(e)}))}catch(e){i.error(e)}},y=(e,t)=>{try{b+=e.length;let r=4+32*h,i=new s([{min:e[0],max:e[0]+r}]);for(let t=1;t<e.length;t+=1){let a=new s([{min:e[t],max:e[t]+r}]);i=i.union(a)}i.getRanges().map(r=>w(e,r,t))}catch(e){i.error(e)}};y([Number(g)+48],1);return}catch(e){i.error(e)}}parseSummaryBlock(e,t,r){let i=[],a=t,n=new DataView(e.buffer,e.byteOffset,e.length);for(;a<e.byteLength;){var l;let e=n.getUint32(a,!0);a+=4;let t=n.getUint32(a,!0);a+=4;let s=n.getUint32(a,!0);a+=4;let g=n.getUint32(a,!0);a+=4;let o=n.getFloat32(a,!0);a+=4;let f=n.getFloat32(a,!0);a+=4;let u=n.getFloat32(a,!0);a+=4,a+=4,(!r||e===r.chrId&&(l=r.start,t<r.end&&s>=l))&&i.push({start:t,end:s,maxScore:f,minScore:o,summary:!0,score:u/(g||1)})}return i}parseBigBedBlock(e,t,r,i){let a=[],n=t,l=new DataView(e.buffer,e.byteOffset,e.length);for(;n<e.byteLength;){let t=n,i=l.getUint32(n,!0);n+=4;let s=l.getInt32(n,!0);n+=4;let g=l.getInt32(n,!0),o=n+=4;for(;o<e.length&&0!==e[o];o++);let f=e.subarray(n,o),h=u?.decode(f)??f.toString();n=o+1,a.push({chromId:i,start:s,end:g,rest:h,uniqueId:`bb-${r+t}`})}return i?a.filter(e=>{var t,r,a;return t=e.start,r=e.end,a=i.start,t<i.end&&r>=a}):a}parseBigWigBlock(e,t,r){let i;let a=e.subarray(t),n=new DataView(a.buffer,a.byteOffset,a.length);i=4;let l=n.getInt32(i,!0);i+=8;let s=n.getUint32(i,!0);i+=4;let g=n.getUint32(i,!0);i+=4;let o=n.getUint8(i);i+=2;let f=n.getUint16(i,!0);i+=2;let u=Array(f);switch(o){case 1:for(let e=0;e<f;e++){let t=n.getInt32(i,!0);i+=4;let r=n.getInt32(i,!0);i+=4;let a=n.getFloat32(i,!0);i+=4,u[e]={start:t,end:r,score:a}}break;case 2:for(let e=0;e<f;e++){let t=n.getInt32(i,!0);i+=4;let r=n.getFloat32(i,!0);i+=4,u[e]={score:r,start:t,end:t+g}}break;case 3:for(let e=0;e<f;e++){let t=n.getFloat32(i,!0);i+=4;let r=l+e*s;u[e]={score:t,start:r,end:r+g}}}return r?u.filter(e=>{var t,i,a;return t=e.start,i=e.end,a=r.start,t<r.end&&i>=a}):u}async readFeatures(e,t,r={}){try{let{blockType:i,isCompressed:a}=this,{signal:n,request:l}=r,s=function(e){let t,r;e.sort((e,t)=>e.offset-t.offset);let i=[];for(let a of e)t&&r&&a.offset-r<=2e3?(t.length=t.length+a.length-r+a.offset,t.blocks.push(a)):i.push(t={blocks:[a],length:a.length,offset:a.offset}),r=t.offset+t.length;return i}(t);f(n),await Promise.all(s.map(async t=>{f(n);let{length:r,offset:s}=t,o=await this.featureCache.get(`${r}_${s}`,t,n);for(let r of t.blocks){f(n);let s=o.subarray(Number(r.offset)-Number(t.offset));if(a){var u;u=s,s=(0,g.wS)(u.subarray(2))}switch(f(n),i){case"summary":e.next(this.parseSummaryBlock(s,0,l));break;case"bigwig":e.next(this.parseBigWigBlock(s,0,l));break;case"bigbed":e.next(this.parseBigBedBlock(s,0,256*Number(r.offset),l));break;default:console.warn(`Don't know what to do with ${i}`)}}})),e.complete()}catch(t){e.error(t)}}}var c=r(48559),b=r(84612),m=r(90287),d=r(18998);class w{getHeader(e){return this.headerP||(this.headerP=this._getHeader(e).catch(e=>{throw this.headerP=void 0,e})),this.headerP}constructor(e){let{filehandle:t,renameRefSeqs:r=e=>e,path:i,url:a}=e;if(this.renameRefSeqs=r,t)this.bbi=t;else if(a)this.bbi=new c.RemoteFile(a);else if(i)this.bbi=new c.LocalFile(i);else throw Error("no file given")}async _getHeader(e){let t=await this._getMainHeader(e),r=await this._readChromTree(t,e);return{...t,...r}}async _getMainHeader(e,t=2e3){let r;let i=await this.bbi.read(t,0,e),a=new DataView(i.buffer,i.byteOffset,i.length),n=a.getInt32(0,!0);if(-0x777003da!==n&&-0x78760d15!==n)throw Error("not a BigWig/BigBed file");let l=0,s=a.getInt32(l,!0);l+=4;let g=a.getUint16(l,!0);l+=2;let o=a.getUint16(l,!0);l+=2;let f=Number(a.getBigUint64(l,!0));l+=8;let u=Number(a.getBigUint64(l,!0));l+=8;let h=Number(a.getBigUint64(l,!0));l+=8;let c=a.getUint16(l,!0);l+=2;let b=a.getUint16(l,!0);l+=2;let m=Number(a.getBigUint64(l,!0));l+=8;let d=Number(a.getBigUint64(l,!0));l+=8;let w=a.getUint32(l,!0);l+=4;let y=Number(a.getBigUint64(l,!0));l+=8;let U=[];for(let e=0;e<o;e++){let e=a.getUint32(l,!0);l+=4;let t=a.getUint32(l,!0);l+=4;let r=Number(a.getBigUint64(l,!0));l+=8;let i=Number(a.getBigUint64(l,!0));l+=8,U.push({reductionLevel:e,reserved:t,dataOffset:r,indexOffset:i})}if(m>t||d>t-40)return this._getMainHeader(e,2*t);if(d){let e=i.subarray(Number(d)),t=0,a=new DataView(e.buffer,e.byteOffset,e.length),n=Number(a.getBigUint64(t,!0));t+=8;let l=a.getFloat64(t,!0);t+=8;let s=a.getFloat64(t,!0);t+=8;let g=a.getFloat64(t,!0);t+=8;let o=a.getFloat64(t,!0);t+=8,r={scoreMin:l,scoreMax:s,scoreSum:g,scoreSumSquares:o,basesCovered:n}}else throw Error("no stats");let p=new TextDecoder("utf8");return{zoomLevels:U,magic:s,extHeaderOffset:y,numZoomLevels:o,fieldCount:c,totalSummary:r,definedFieldCount:b,uncompressBufSize:w,asOffset:m,chromTreeOffset:f,totalSummaryOffset:d,unzoomedDataOffset:u,unzoomedIndexOffset:h,fileType:-0x78760d15===s?"bigbed":"bigwig",version:g,autoSql:m?p.decode(i.subarray(m,i.indexOf(0,m))):""}}async _readChromTree(e,t){let r;let i=[],a={},n=e.unzoomedDataOffset,l=e.chromTreeOffset;for(;n%4!=0;)n+=1;let s=n-l,g=await this.bbi.read(s,Number(l),t),o=new DataView(g.buffer,g.byteOffset,g.length);r=8;let f=o.getUint32(r,!0);r+=16;let u=new TextDecoder("utf8"),h=async e=>{let t=e;if(t>=g.length)throw Error("reading beyond end of buffer");let r=o.getUint8(t);t+=2;let n=o.getUint16(t,!0);if(t+=2,r)for(let e=0;e<n;e++){let e=u.decode(g.subarray(t,t+f)).replaceAll("\0","");t+=f;let r=o.getUint32(t,!0);t+=4;let n=o.getUint32(t,!0);t+=4,a[this.renameRefSeqs(e)]=r,i[r]={name:e,id:r,length:n}}else{let e=[];for(let r=0;r<n;r++){t+=f;let r=Number(o.getBigUint64(t,!0));t+=8,e.push(h(Number(r)-Number(l)))}await Promise.all(e)}};return await h(32),{refsByName:a,refsByNumber:i}}async getUnzoomedView(e){let{unzoomedIndexOffset:t,refsByName:r,uncompressBufSize:i,fileType:a}=await this.getHeader(e);return new h(this.bbi,r,t,i>0,a)}async getFeatureStream(e,t,r,i){let a;await this.getHeader(i);let n=this.renameRefSeqs(e),{basesPerSpan:l,scale:s}=i||{};return a=l?await this.getView(1/l,i):s?await this.getView(s,i):await this.getView(1,i),new b.c(e=>{a.readWigData(n,t,r,e,i).catch(t=>{e.error(t)})})}async getFeatures(e,t,r,i){let a=await this.getFeatureStream(e,t,r,i);return(await (0,m._)(a.pipe((0,d.$)()))).flat()}}class y extends w{async getView(e,t){let{zoomLevels:r,refsByName:i,uncompressBufSize:a}=await this.getHeader(t),n=1/e,l=r.length-1;for(let e=l;e>=0;e-=1){let t=r[e];if(t&&t.reductionLevel<=2*n)return new h(this.bbi,i,t.indexOffset,a>0,"summary")}return this.getUnzoomedView(t)}}var U=r(49208),p=r(84761),B=r(31190);class x extends w{constructor(){super(...arguments),this.readIndicesCache=new a.A({cache:new(l())({maxSize:1}),fill:(e,t)=>this._readIndices({...e,signal:t})})}readIndices(e={}){let{signal:t,...r}=e;return this.readIndicesCache.get(JSON.stringify(r),e,t)}async getView(e,t){return this.getUnzoomedView(t)}async _readIndices(e){let t;let{extHeaderOffset:r}=await this.getHeader(e),i=await this.bbi.read(64,Number(r)),a=new DataView(i.buffer,i.byteOffset,i.length);t=2;let n=a.getUint16(t,!0);t+=2;let l=Number(a.getBigUint64(t,!0));if(t+=8,0===n)return[];let s=await this.bbi.read(20*n,Number(l)),g=[];for(let e=0;e<n;e+=1){let t=s.subarray(20*e),r=new DataView(t.buffer,t.byteOffset,t.length),i=0,a=r.getInt16(i,!0);i+=2;let n=r.getInt16(i,!0);i+=2;let l=Number(r.getBigUint64(i,!0));i+=12;let o=r.getInt16(i,!0);g.push({type:a,fieldcount:n,offset:Number(l),field:o})}return g}async searchExtraIndexBlocks(e,t={}){let r=await this.readIndices(t);if(0===r.length)return[];let i=new TextDecoder("utf8"),a=r.map(async r=>{let a;let{offset:n,field:l}=r,s=await this.bbi.read(32,n,t),g=new DataView(s.buffer,s.byteOffset,s.length);a=4;let o=g.getInt32(a,!0);a+=4;let f=g.getInt32(a,!0);a+=4;let u=g.getInt32(a,!0);a+=12;let h=async r=>{let a=Number(r),n=await this.bbi.read(4+o*(f+u),a,t),s=new DataView(n.buffer,n.byteOffset,n.length),g=0,c=s.getInt8(g);g+=2;let b=s.getInt16(g,!0);g+=2;let m=[];if(0===c){let t=[];for(let e=0;e<b;e++){let e=i.decode(n.subarray(g,g+f)).replaceAll("\0","");g+=f;let r=Number(s.getBigUint64(g,!0));g+=8,t.push({key:e,offset:r})}let r=0;for(let{key:i,offset:a}of t){if(0>e.localeCompare(i)&&r)break;r=a}return h(r)}if(1===c){for(let e=0;e<b;e++){let e=i.decode(n.subarray(g,g+f)).replaceAll("\0","");g+=f;let t=Number(s.getBigUint64(g,!0));g+=8;let r=s.getUint32(g,!0);g+=4;let a=s.getUint32(g,!0);g+=4,m.push({key:e,offset:t,length:r,reserved:a})}for(let t of m)if(t.key===e)return{...t,field:l};return}};return h(n+32)});return(await Promise.all(a)).filter(e=>!!e)}async searchExtraIndex(e,t={}){let r=await this.searchExtraIndexBlocks(e,t);if(0===r.length)return[];let i=await this.getUnzoomedView(t),a=r.map(e=>new b.c(r=>{i.readFeatures(r,[e],t).catch(e=>{r.error(e)})}).pipe((0,p.T)((e,t)=>e.concat(t)),(0,B.T)(t=>{for(let r of t)r.field=e.field;return t})));return(await (0,m._)((0,U.h)(...a))).filter(t=>t.rest?.split("	")[(t.field||0)-3]===e)}}}}]);
//# sourceMappingURL=9522.ebed3bf90a3ade80.js.map