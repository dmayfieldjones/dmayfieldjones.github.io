"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3477],{53477:(e,t,o)=>{o.d(t,{makeImage:()=>c});var l=o(88753),n=o(94029),r=o(15715),a=o(64294),i=o(25364),s=o(68821);let f={C:"G",G:"C",A:"T",T:"A"};async function c(e,t){var o,c,p,b,y,h,d,u,k,m;let{features:v,regions:g,bpPerPx:S,colorBy:T,displayCrossHatches:w,visibleModifications:C={},scaleOpts:O,height:D,theme:_,config:j,ticks:M,stopToken:N}=t,R=(0,n.createJBrowseTheme)(_),P=g[0],x=(P.end-P.start)/S,A=i.Oy,G=D-2*A,I={...O,range:[0,G]},$=(0,i.X_)(I),z=(0,i.X_)({...I,range:[0,G/2],scaleType:"linear"}),E=(0,i.$z)(O.scaleType),W=(0,i.$z)("linear"),X=(0,l.readConfObject)(j,"indicatorThreshold"),B=(0,l.readConfObject)(j,"showInterbaseCounts"),J=(0,l.readConfObject)(j,"showArcs"),U=(0,l.readConfObject)(j,"showInterbaseIndicators"),q=e=>G-($(e)||0)+A,F=e=>q(E)-q(e),H=e=>G-(z(e)||0)+A,K=e=>H(W)-H(e),{bases:L,softclip:Q,hardclip:V,insertion:Y}=R.palette,Z={A:L.A.main,C:L.C.main,G:L.G.main,T:L.T.main,insertion:Y,softclip:Q,hardclip:V,total:(0,l.readConfObject)(j,"color"),mod_NONE:"blue",cpg_meth:"red",cpg_unmeth:"blue"},ee=[...v.values()];e.fillStyle=Z.total;let et=performance.now();for(let t of ee){if("skip"===t.get("type"))continue;let[o,l]=(0,r.featureSpanPx)(t,P,S),n=l-o+.6,i=t.get("score");e.fillRect(o,q(i),n,F(i)),performance.now()-et>400&&((0,a.checkStopToken)(N),et=performance.now())}let eo=0,el=P.reversed?1/S:0,en="modifications"===T.type,er="methylation"===T.type,ea=null==(o=T.modifications)?void 0:o.isolatedModification;for(let t of(et=performance.now(),ee)){if(performance.now()-et>400&&(0,a.checkStopToken)(N),"skip"===t.get("type"))continue;let[o,l]=(0,r.featureSpanPx)(t,P,S),n=t.get("snpinfo"),i=Math.max(l-o,1),v=t.get("score");if(en){let t=0,l=null==(c=n.refbase)?void 0:c.toUpperCase(),{nonmods:r,mods:a,snps:g,ref:S}=n;for(let a of Object.keys(r).sort().reverse()){let r=C[a.replace("nonmod_","")]||C[a.replace("mod_","")];if(!r){console.warn(`${a} not known yet`);continue}if(ea&&r.type!==ea)continue;let c=f[r.base],d="N"===r.base?v:((null==(p=g[r.base])?void 0:p.entryDepth)||0)+((null==(b=g[c])?void 0:b.entryDepth)||0)+(l===r.base?S["1"]:0)+(l===c?S["-1"]:0),u="N"===r.base?v:((null==(y=g[r.base])?void 0:y.entryDepth)||0)+((null==(h=g[c])?void 0:h.entryDepth)||0)+(l===r.base?S.entryDepth:0)+(l===c?S.entryDepth:0),{entryDepth:k,avgProbability:m=0}=n.nonmods[a],T=u/v*(k/d),w=(0,s.yr)("blue",m),O=F(v),D=q(v)+O;e.fillStyle=w,e.fillRect(Math.round(o),D-(t+T*O),i,T*O),t+=T*O}for(let n of Object.keys(a).sort().reverse()){let r=C[n.replace("mod_","")];if(!r){console.warn(`${n} not known yet`);continue}if(ea&&r.type!==ea)continue;let c=f[r.base],p="N"===r.base?v:((null==(d=g[r.base])?void 0:d.entryDepth)||0)+((null==(u=g[c])?void 0:u.entryDepth)||0)+(l===r.base?S["1"]:0)+(l===c?S["-1"]:0),b="N"===r.base?v:((null==(k=g[r.base])?void 0:k.entryDepth)||0)+((null==(m=g[c])?void 0:m.entryDepth)||0)+(l===r.base?S.entryDepth:0)+(l===c?S.entryDepth:0),{entryDepth:y,avgProbability:h=0}=a[n],T=b/v*(y/p),w=r.color||"black",O=(0,s.yr)(w,h),D=F(v),_=q(v)+D;e.fillStyle=O,e.fillRect(Math.round(o),_-(t+T*D),i,T*D),t+=T*D}}else if(er){let{depth:t,nonmods:l,mods:r}=n,a=0;for(let l of Object.keys(r).sort().reverse()){let{entryDepth:n}=r[l],s=F(v),f=q(v)+s;e.fillStyle=Z[l]||"black",e.fillRect(Math.round(o),f-(n+a)/t*s,i,n/t*s),a+=n}for(let n of Object.keys(l).sort().reverse()){let{entryDepth:r}=l[n],s=F(v),f=q(v)+s;e.fillStyle=Z[n]||"black",e.fillRect(Math.round(o),f-(r+a)/t*s,i,r/t*s),a+=r}}else{let{depth:t,snps:l}=n,r=0;for(let n of Object.keys(l).sort().reverse()){let{entryDepth:a}=l[n],s=F(v),f=q(v)+s;e.fillStyle=Z[n]||"black",e.fillRect(Math.round(o),f-(a+r)/t*s,i,a/t*s),r+=a}}let g=Object.keys(n.noncov);if(B){let t=0;for(let l of g){let{entryDepth:r}=n.noncov[l];e.fillStyle=Z[l],e.fillRect(o-.6+el,4.5+K(t),1.2,K(r)),t+=r}}if(U){let t=0,l=0,r="";for(let e of g){let{entryDepth:o}=n.noncov[e];t+=o,o>l&&(l=o,r=e)}let a=Math.max(v,eo);if(t>a*X&&a>7){e.fillStyle=Z[r],e.beginPath();let t=o+el;e.moveTo(t-3.5,0),e.lineTo(t+3.5,0),e.lineTo(t,4.5),e.fill()}}eo=v}if(J)for(let t of ee){if("skip"!==t.get("type"))continue;let o=t.get("start"),l=t.get("end"),[n,a]=(0,r.bpSpanPx)(o,l,P,S);e.beginPath();let i=t.get("effectiveStrand");1===i?e.strokeStyle="rgba(255,200,200,0.7)":-1===i?e.strokeStyle="rgba(200,200,255,0.7)":e.strokeStyle="rgba(200,200,200,0.7)",e.lineWidth=Math.log(t.get("score")+1),e.moveTo(n,G-2*A),e.bezierCurveTo(n,0,a,0,a,G-2*A),e.stroke()}if(w)for(let t of(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",M.values))e.beginPath(),e.moveTo(0,Math.round(q(t))),e.lineTo(x,Math.round(q(t))),e.stroke()}}}]);
//# sourceMappingURL=3477.49ffdc58cb95128c.js.map