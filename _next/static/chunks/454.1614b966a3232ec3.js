"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{20454:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});let n=BigInt(32);"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(e,t){let i=Number(!!t),a=Number(!t);return BigInt(this.getInt32(e,t)*a+this.getInt32(e+4,t)*i)<<n|BigInt(this.getUint32(e,t)*i+this.getUint32(e+4,t)*a)}),"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(e,t){return function(e,t,i){let a=e.getUint32(t,i),s=e.getUint32(t+4,i),r=Number(!!i),l=Number(!i);return BigInt(a*l+s*r)<<n|BigInt(a*r+s*l)}(this,e,t)});var a=i(98135);let s=["T","C","A","G"],r=[];for(let e=0;e<256;e++)r.push(s[e>>6&3]+s[e>>4&3]+s[e>>2&3]+s[3&e]);let l=r.map(e=>e.toLowerCase());class o{constructor({filehandle:e,path:t}){if(e)this.filehandle=e;else if(t)this.filehandle=new a.LocalFile(t);else throw Error("must supply path or filehandle")}async _detectEndianness(){let e=new DataView((await this.filehandle.read(8,0)).buffer);if(0x1a412743===e.getInt32(0,!0))this.version=e.getInt32(0,!0);else throw Error("not a 2bit file")}getHeader(){return this.headerP||(this.headerP=this._getHeader().catch(e=>{throw this.headerP=void 0,e})),this.headerP}async _getHeader(){await this._detectEndianness();let e=await this.filehandle.read(16,0),t=new DataView(e.buffer,e.byteOffset,e.length),i=0,n=t.getInt32(i,!0);if(i+=4,0x1a412743!==n)throw Error(`Wrong magic number ${n}`);let a=t.getInt32(i,!0);i+=4;let s=t.getUint32(i,!0);return i+=4,{version:a,magic:n,sequenceCount:s,reserved:t.getUint32(i,!0)}}getIndex(){return this.indexP||(this.indexP=this._getIndex().catch(e=>{throw this.indexP=void 0,e})),this.indexP}async _getIndex(){let e=await this.getHeader(),t=8+e.sequenceCount*(257+(1===this.version?8:4)),i=await this.filehandle.read(t,8),n=new DataView(i.buffer,i.byteOffset,i.length),a=0,s=n.getUint32(a,!0);a+=4,a+=4;let r=[],l=new TextDecoder("utf8");for(let t=0;t<s;t++){let t=n.getUint8(a);a+=1;let s=l.decode(i.subarray(a,a+t));if(a+=t,1===e.version){let e=Number(n.getBigUint64(a,!0));a+=8,r.push({offset:e,name:s})}else{let e=n.getUint32(a,!0);a+=4,r.push({offset:e,name:s})}}return Object.fromEntries(r.map(({name:e,offset:t})=>[e,t]))}async getSequenceNames(){return Object.keys(await this.getIndex())}async getSequenceSizes(){let e=await this.getIndex(),t=Object.keys(e),i=await Promise.all(Object.values(e).map(e=>this._getSequenceSize(e))),n={};for(let[e,a]of t.entries())n[a]=i[e];return n}async getSequenceSize(e){let t=(await this.getIndex())[e];return t?this._getSequenceSize(t):void 0}async _getSequenceSize(e){return this._record1(e).then(e=>e.dnaSize)}async _record1(e,t=8){let i=await this.filehandle.read(t,e),n=0,a=new DataView(i.buffer,i.byteOffset,i.length),s=a.getUint32(n,!0);n+=4;let r=a.getUint32(n,!0);return n+=4,{dnaSize:s,nBlockCount:r}}async _record2(e,t){let i=await this.filehandle.read(t,e),n=0,a=new DataView(i.buffer,i.byteOffset,i.length),s=a.getUint32(n,!0);n+=4;let r=[];for(let e=0;e<s;e++){let e=a.getUint32(n,!0);n+=4,r.push(e)}let l=[];for(let e=0;e<s;e++){let e=a.getUint32(n,!0);n+=4,l.push(e)}return{maskBlockCount:a.getUint32(n,!0),nBlockSizes:l,nBlockStarts:r}}async _record3(e,t){let i=await this.filehandle.read(t,e),n=0,a=new DataView(i.buffer,i.byteOffset,i.length),s=a.getUint32(n,!0);n+=4;let r=[];for(let e=0;e<s;e++){let e=a.getUint32(n,!0);n+=4,r.push(e)}let l=[];for(let e=0;e<s;e++){let e=a.getUint32(n,!0);n+=4,l.push(e)}return{maskBlockCount:s,maskBlockSizes:l,maskBlockStarts:r,reserved:a.getInt32(n,!0)}}async _getSequenceRecord(e){let t=await this._record1(e),i=8*t.nBlockCount+8,n=await this._record2(e+4,i),a=8*n.maskBlockCount+8,s=await this._record3(e+4+i-4,a);return{dnaSize:t.dnaSize,nBlocks:{starts:n.nBlockStarts,sizes:n.nBlockSizes},maskBlocks:{starts:s.maskBlockStarts,sizes:s.maskBlockSizes},dnaPosition:e+4+i-4+a}}async getSequence(e,t=0,i=Number.POSITIVE_INFINITY){let n=(await this.getIndex())[e];if(!n)return;let a=await this._getSequenceRecord(n);if(t<0)throw TypeError("regionStart cannot be less than 0");i>a.dnaSize&&(i=a.dnaSize);let s=this._getOverlappingBlocks(t,i,a.nBlocks.starts,a.nBlocks.sizes),o=this._getOverlappingBlocks(t,i,a.maskBlocks.starts,a.maskBlocks.sizes),h=Math.ceil((i-t)/4)+1,c=Math.floor(t/4),u=await this.filehandle.read(h,a.dnaPosition+c),g="";for(let e=t;e<i;e+=1){for(;o.length>0&&o[0].end<=e;)o.shift();let t=o[0]&&o[0].start<=e&&o[0].end>e;if(s[0]&&e>=s[0].start&&e<s[0].end){let n=s.shift();for(;e<n.end&&e<i;e+=1)g+=t?"n":"N";e-=1}else{let i=Math.floor(e/4)-c,n=e%4,a=u[i];g+=t?l[a][n]:r[a][n]}}return g}_getOverlappingBlocks(e,t,i,n){let a,s;for(let[r,l]of i.entries())if(e>=l+n[r]||t<=l){if(void 0!==a){s=r;break}}else void 0===a&&(a=r);if(void 0===a)return[];void 0===s&&(s=i.length);let r=Array(s-a);for(let e=a;e<s;e+=1)r[e-a]={start:i[e],end:i[e]+n[e],size:n[e]};return r}}var h=i(88753),c=i(29269),u=i(64446),g=i(31232),d=i(91603);class f extends c.BaseSequenceAdapter{async initChromSizes(){let e=(0,h.readConfObject)(this.config,"chromSizesLocation");if("/path/to/default.chrom.sizes"!==e.uri&&""!==e.uri){let t=(0,u.openLocation)(e,this.pluginManager);return Object.fromEntries((await t.readFile("utf8")).split(/\n|\r\n|\r/).filter(e=>!!e.trim()).map(e=>{let[t,i]=e.split("	");return[t,+i]}))}}async setupPre(){return{twobit:new o({filehandle:(0,u.openLocation)(this.getConf("twoBitLocation"),this.pluginManager)}),chromSizesData:await this.initChromSizes()}}async setup(){return this.setupP||(this.setupP=this.setupPre().catch(e=>{throw this.setupP=void 0,e})),this.setupP}async getRefNames(){let{chromSizesData:e,twobit:t}=await this.setup();return e?Object.keys(e):t.getSequenceNames()}async getRegions(){let{chromSizesData:e,twobit:t}=await this.setup();if(e)return Object.keys(e).map(t=>({refName:t,start:0,end:e[t]}));{let e=await t.getSequenceSizes();return Object.keys(e).map(t=>({refName:t,start:0,end:e[t]}))}}getFeatures({refName:e,start:t,end:i}){return(0,g.ObservableCreate)(async n=>{let{twobit:a}=await this.setup(),s=await a.getSequenceSize(e),r=void 0!==s?Math.min(s,i):i,l=await a.getSequence(e,t,r);l&&n.next(new d.default({id:`${e} ${t}-${r}`,data:{refName:e,start:t,end:r,seq:l}})),n.complete()})}freeResources(){}}}}]);
//# sourceMappingURL=454.1614b966a3232ec3.js.map