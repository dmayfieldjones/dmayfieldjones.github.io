"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7275],{7275:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var r=a(1986),s=a(40488),l=a(29269),n=a(15715),i=a(64446),o=a(31232),h=a(72796);class u extends l.BaseFeatureDataAdapter{constructor(){super(...arguments),this.intervalTrees={}}async loadDataP(e={}){let t=this.pluginManager,a=this.getConf("bedLocation"),r=await (0,n.fetchAndMaybeUnzip)((0,i.openLocation)(a,t),e);if(r.length>0x1fffffe8)throw Error("Data exceeds maximum string length (512MB)");let l=new TextDecoder("utf8",{fatal:!0}).decode(r).split(/\n|\r\n|\r/).filter(e=>!!e),o=[],h=0;for(;h<l.length&&l[h].startsWith("#");h++)o.push(l[h]);let u=o.join("\n"),c={};for(;h<l.length;h++){let e=l[h],t=e.indexOf("	"),a=e.slice(0,t);c[a]||(c[a]=[]),c[a].push(e)}let d=this.getConf("autoSql"),f=new s.A({autoSql:d}),g=this.getConf("columnNames"),p=this.getConf("scoreColumn"),v=this.getConf("colRef");return{header:u,features:c,parser:f,columnNames:g,scoreColumn:p,colRef:v,colStart:this.getConf("colStart"),colEnd:this.getConf("colEnd")}}async loadData(e={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(e).catch(e=>{throw this.bedFeatures=void 0,e})),this.bedFeatures}async getRefNames(e={}){let{features:t}=await this.loadData(e);return Object.keys(t)}async getHeader(e={}){let{header:t}=await this.loadData(e);return t}async getNames(){let{header:e,columnNames:t}=await this.loadData();if(t.length)return t;let a=e.split(/\n|\r\n|\r/).filter(e=>!!e).at(-1);return(null==a?void 0:a.includes("	"))?a.slice(1).split("	").map(e=>e.trim()):void 0}async loadFeatureIntervalTreeHelper(e){let{colRef:t,colStart:a,colEnd:s,features:l,parser:i,scoreColumn:o}=await this.loadData(),u=l[e];if(!u)return;let c=await this.getNames(),d=new r.Ay;for(let r=0;r<u.length;r++){let l=u[r],f=`${this.id}-${e}-${r}`,g=new n.SimpleFeature((0,h.dE)({line:l,colRef:t,colStart:a,colEnd:s,scoreColumn:o,parser:i,uniqueId:f,names:c}));d.insert([g.get("start"),g.get("end")],g)}return d}async loadFeatureIntervalTree(e){return this.intervalTrees[e]||(this.intervalTrees[e]=this.loadFeatureIntervalTreeHelper(e).catch(t=>{throw this.intervalTrees[e]=void 0,t})),this.intervalTrees[e]}getFeatures(e,t={}){return(0,o.ObservableCreate)(async t=>{let{start:a,end:r,refName:s}=e,l=await this.loadFeatureIntervalTree(s),n=null==l?void 0:l.search([a,r]);if(n)for(let e of n)t.next(e);t.complete()},t.stopToken)}freeResources(){}}u.capabilities=["getFeatures","getRefNames"];let c=u}}]);
//# sourceMappingURL=7275.c7bcc0aac93cfb3d.js.map