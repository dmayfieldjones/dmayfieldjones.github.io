"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8951],{68951:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});class i{ixxFile;ixFile;maxResults;constructor(e,t,r=20){this.ixxFile=e,this.ixFile=t,this.maxResults=r}async search(e,t){let r=[],i=e.split(" ")[0].toLowerCase(),l=await this._getBuffer(i,t);if(!l)return[];let{end:n,buffer:s}=l,a=!1,o=new TextDecoder("utf8").decode(s);for(;!a;){let e=!1,l=o.slice(0,o.lastIndexOf("\n")).split("\n").filter(e=>!!e),c=[];for(let t of l){let r=t.split(" ")[0],l=r.startsWith(i);!e&&l&&(e=!0),r.slice(0,i.length)>i&&(a=!0),l&&c.push(t)}let u=c.flatMap(e=>{let[t,...r]=e.split(" ");return r.map(e=>[t,e.split(",")[0]])});if(r.length+u.length<this.maxResults&&!a){let e=await this.ixFile.read(65536,n,t);if(0===e.length){r=r.concat(u);break}s=function(e){let t=new Uint8Array(function(e){let t=0;for(let r of e)t+=r.length;return t}(e)),r=0;for(let i of e)t.set(i,r),r+=i.length;return t}([s,e]),n+=65536}else if(r.length+u.length>=this.maxResults||a){r=r.concat(u);break}}return(function(e,t){let r=new Set;return e.filter(e=>{let i=t(e);return!r.has(i)&&r.add(i)})})(r,e=>e[1]).slice(0,this.maxResults)}async getIndex(e){return(await this.ixxFile.readFile({encoding:"utf8",...e})).split("\n").filter(e=>!!e).map(e=>{let t=e.length-10;return[e.slice(0,t),Number.parseInt(e.slice(t),16)]})}async _getBuffer(e,t){let r=0,i=65536;for(let[l,n]of(await this.getIndex(t)))l.slice(0,e.length)<e&&(r=n,i=n+65536);let l=i-r;if(!(l<0))return{buffer:await this.ixFile.read(l,r,t),end:i}}}var l=r(4836),n=r(53394),s=r(92766),a=r(31177);function o(e){try{return decodeURIComponent(e)}catch(t){return e}}function c(e,t,r=15){let i=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,i-r)>0?"...":"")+e.slice(Math.max(0,i-r),i+t.length+r).trim()+(i+t.length<e.length?"...":"")}class u extends s.BaseAdapter{constructor(e,t,r){super(e,t,r);let l=(0,n.readConfObject)(e,"ixFilePath"),s=(0,n.readConfObject)(e,"ixxFilePath");if(!l)throw Error("must provide out.ix");if(!s)throw Error("must provide out.ixx");this.trixJs=new i((0,a.openLocation)(s,r),(0,a.openLocation)(l,r),1500)}async searchIndex(e){let t=e.queryString.toLowerCase(),r=t.split(" "),i=(await this.trixJs.search(t)).filter(([,e])=>r.every(t=>o(e).toLowerCase().includes(t))).map(([e,t])=>{let r=JSON.parse(t.replaceAll("|",",")),[i,n,...s]=r.map(e=>o(e)),a=s.findIndex(e=>!!e),u=s.map(e=>e.toLowerCase()).findIndex(t=>t.includes(e.toLowerCase())),f=s[a],h=s[u],x=-1!==u?c(h,e):void 0,d=c(f,e),p=x&&d.toLowerCase()!==x.toLowerCase()?`${d} (${x})`:d;return new l.Ay({locString:i,label:f,displayString:p,matchedObject:r.map(e=>decodeURIComponent(e)),trackId:n})});return"exact"===e.searchType?i.filter(t=>t.getLabel().toLowerCase()===e.queryString.toLowerCase()):i}freeResources(){}}}}]);
//# sourceMappingURL=8951.06ade98dbb3e8e6a.js.map