"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3450],{43450:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var s=a(1986),r=a(86168),i=a(29269),n=a(15715),l=a(64446),c=a(31232),u=a(14974);class p extends i.BaseFeatureDataAdapter{constructor(){super(...arguments),this.calculatedIntervalTreeMap={}}async getHeader(){let{header:e}=await this.setup();return e}async getMetadata(){let{parser:e}=await this.setup();return e.getMetadata()}async setupP(e){let{statusCallback:t=()=>{}}=e||{},a=(0,l.openLocation)(this.getConf("vcfLocation"),this.pluginManager),i=await (0,n.fetchAndMaybeUnzip)(a,e),c=[],p={},o=0,h=new TextDecoder("utf8"),f=0;for(;o<i.length;){let e=i.indexOf(10,o),a=-1===e?i.subarray(o):i.subarray(o,e),s=h.decode(a).trim();if(s){if(s.startsWith("#"))c.push(s);else{let e=s.indexOf("	"),t=s.slice(0,e);p[t]||(p[t]=[]),p[t].push(s)}}f++%1e4==0&&t(`Loading ${(0,n.getProgressDisplayStr)(o,i.length)}`),o=e+1}let d=c.join("\n"),g=new r.A({header:d}),v=Object.fromEntries(Object.entries(p).map(([e,t])=>[e,a=>{if(!this.calculatedIntervalTreeMap[e]){null==a||a("Parsing VCF data");let r=0,i=new s.Ay;for(let a of t){let t=new u.A({variant:g.parseLine(a),parser:g,id:`${this.id}-${e}-${r++}`});i.insert([t.get("start"),t.get("end")],t)}this.calculatedIntervalTreeMap[e]=i}return this.calculatedIntervalTreeMap[e]}]));return{header:d,parser:g,intervalTreeMap:v}}async setup(){return this.vcfFeatures||(this.vcfFeatures=this.setupP().catch(e=>{throw this.vcfFeatures=void 0,e})),this.vcfFeatures}async getRefNames(e={}){let{intervalTreeMap:t}=await this.setup();return Object.keys(t)}getFeatures(e,t={}){return(0,c.ObservableCreate)(async a=>{var s;try{let{start:r,end:i,refName:n}=e,{intervalTreeMap:l}=await this.setup();for(let e of(null===(s=l[n])||void 0===s?void 0:s.call(l,t.statusCallback).search([r,i]))||[])a.next(e);a.complete()}catch(e){a.error(e)}},t.stopToken)}async getSources(){let e=this.getConf("samplesTsvLocation");if(""===e.uri||"/path/to/samples.tsv"===e.uri){let{parser:e}=await this.setup();return e.samples.map(e=>({name:e}))}{let t=(await (0,l.openLocation)(e).readFile("utf8")).split(/\n|\r\n|\r/),a=t[0].split("	"),{parser:s}=await this.setup(),r=new Set(s.samples);return t.slice(1).map(e=>{let t=e.split("	");return{name:t[0],...Object.fromEntries(t.slice(1).map((e,t)=>[a[t+1],e]))}}).filter(e=>r.has(e.name))}}freeResources(){}}p.capabilities=["getFeatures","getRefNames"];let o=p}}]);
//# sourceMappingURL=3450.78cff6b4b34f5973.js.map