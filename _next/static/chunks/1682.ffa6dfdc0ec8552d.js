"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1682],{91682:(e,t,i)=>{i.d(t,{wD:()=>y});var n=i(28126),r=i(68134),a=i.n(r),s=i(75927),l=i(82485),o=i(91986);function d(e){if(e.greaterThan(Number.MAX_SAFE_INTEGER)||e.lessThan(Number.MIN_SAFE_INTEGER))throw Error("integer overflow");return e.toNumber()}class h extends Error{}function f(e){if(e&&e.aborted){if("undefined"!=typeof DOMException)throw new DOMException("aborted","AbortError");{let e=new h("aborted");throw e.code="ERR_ABORTED",e}}}function c(e,t){let i=[],n=null;return 0===e.length?e:(e.sort(function(e,t){let i=e.minv.blockPosition-t.minv.blockPosition;return 0!==i?i:e.minv.dataPosition-t.minv.dataPosition}),e.forEach(e=>{if(!t||e.maxv.compareTo(t)>0){if(null===n)i.push(e),n=e;else{var r;(r=n,e.minv.blockPosition-r.maxv.blockPosition<65e3&&e.maxv.blockPosition-r.minv.blockPosition<5e6)?e.maxv.compareTo(n.maxv)>0&&(n.maxv=e.maxv):(i.push(e),n=e)}}}),i)}var u=i(92952),m=i.n(u);class p{constructor(e,t){this.blockPosition=e,this.dataPosition=t}toString(){return`${this.blockPosition}:${this.dataPosition}`}compareTo(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}}function x(e,t=0,i=!1){if(i)throw Error("big-endian virtual file offsets not implemented");return new p(0x10000000000*e[t+7]+0x100000000*e[t+6]+0x1000000*e[t+5]+65536*e[t+4]+256*e[t+3]+e[t+2],e[t+1]<<8|e[t])}class b{constructor(e,t,i,n){this.minv=e,this.maxv=t,this.bin=i,this._fetchedSize=n}toUniqueString(){return`${this.minv}..${this.maxv} (bin ${this.bin}, fetchedSize ${this.fetchedSize()})`}toString(){return this.toUniqueString()}compareTo(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}fetchedSize(){return void 0!==this._fetchedSize?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}class w{constructor({filehandle:e,renameRefSeqs:t=e=>e}){this.filehandle=e,this.renameRefSeq=t}async getMetadata(e={}){let{indices:t,...i}=await this.parse(e);return i}_findFirstData(e,t){return e?e.compareTo(t)>0?t:e:t}async parse(e={}){return this.parseP||(this.parseP=this._parse(e).catch(e=>{throw this.parseP=void 0,e})),this.parseP}async hasRefSeq(e,t={}){var i;return!!(null===(i=(await this.parse(t)).indices[e])||void 0===i?void 0:i.binIndex)}}class g extends w{async lineCount(e,t={}){let i=await this.parse(t),n=i.refNameToId[e];if(void 0===n||!i.indices[n])return -1;let{stats:r}=i.indices[n];return r?r.lineCount:-1}async _parse(e={}){let t;let i=await this.filehandle.readFile(e),n=await (0,o.unzip)(i);if(f(e.signal),0x1494254!==n.readUInt32LE(0))throw Error("Not a TBI file");let r=n.readInt32LE(4),a=n.readInt32LE(8),s={0:"generic",1:"SAM",2:"VCF"}[15&a];if(!s)throw Error(`invalid Tabix preset format flags ${a}`);let l={ref:n.readInt32LE(12),start:n.readInt32LE(16),end:n.readInt32LE(20)},d=n.readInt32LE(24),h=d?String.fromCharCode(d):null,c=n.readInt32LE(28),u=n.readInt32LE(32),{refNameToId:m,refIdToName:p}=this._parseNameBytes(n.slice(36,36+u)),w=36+u;return{indices:Array(r).fill(0).map(()=>{let e;let i=n.readInt32LE(w);w+=4;let r={};for(let a=0;a<i;a+=1){let i=n.readUInt32LE(w);if(w+=4,i>37450)throw Error("tabix index contains too many bins, please use a CSI index");if(37450===i){let t=n.readInt32LE(w);w+=4,2===t&&(e=this.parsePseudoBin(n,w)),w+=16*t}else{let e=n.readInt32LE(w);w+=4;let a=Array(e);for(let r=0;r<e;r+=1){let e=x(n,w),s=x(n,w+8);w+=16,t=this._findFirstData(t,e),a[r]=new b(e,s,i)}r[i]=a}}let a=n.readInt32LE(w);w+=4;let s=Array(a);for(let e=0;e<a;e+=1)s[e]=x(n,w),w+=8,t=this._findFirstData(t,s[e]);return{binIndex:r,linearIndex:s,stats:e}}),metaChar:h,maxBinNumber:37449,maxRefLength:0x20000000,skipLines:c,firstDataLine:t,columnNumbers:l,coordinateType:65536&a?"zero-based-half-open":"1-based-closed",format:s,refIdToName:p,refNameToId:m,maxBlockSize:65536}}parsePseudoBin(e,t){return{lineCount:d(m().fromBytesLE(e.slice(t+16,t+24),!0))}}_parseNameBytes(e){let t=0,i=0,n=[],r={};for(let a=0;a<e.length;a+=1)if(!e[a]){if(i<a){let s=e.toString("utf8",i,a);s=this.renameRefSeq(s),n[t]=s,r[s]=t}i=a+1,t+=1}return{refNameToId:r,refIdToName:n}}async blocksForRange(e,t,i,n={}){var r,a;t<0&&(t=0);let s=await this.parse(n),l=s.refNameToId[e];if(void 0===l)return[];let o=s.indices[l];if(!o)return[];(o.linearIndex.length?o.linearIndex[t>>14>=o.linearIndex.length?o.linearIndex.length-1:t>>14]:new p(0,0))||console.warn("querying outside of possible tabix range");let d=[[0,0],[1+((r=t+1)>>26),1+((a=i-1)>>26)],[9+(r>>23),9+(a>>23)],[73+(r>>20),73+(a>>20)],[585+(r>>17),585+(a>>17)],[4681+(r>>14),4681+(a>>14)]],h=[];for(let[e,t]of d)for(let i=e;i<=t;i++)if(o.binIndex[i])for(let e of o.binIndex[i])h.push(new b(e.minv,e.maxv,i));let f=o.linearIndex.length,u=null,m=Math.min(t>>14,f-1),x=Math.min(i>>14,f-1);for(let e=m;e<=x;++e){let t=o.linearIndex[e];t&&(!u||0>t.compareTo(u))&&(u=t)}return c(h,u)}}function v(e,t){return Math.floor(e/2**t)}class E extends w{constructor(e){super(e),this.maxBinNumber=0,this.depth=0,this.minShift=0}async lineCount(e,t={}){let i=await this.parse(t),n=i.refNameToId[e];if(void 0===n||!i.indices[n])return -1;let{stats:r}=i.indices[n];return r?r.lineCount:-1}indexCov(){throw Error("CSI indexes do not support indexcov")}parseAuxData(e,t){let i=e.readInt32LE(t),n={0:"generic",1:"SAM",2:"VCF"}[15&i];if(!n)throw Error(`invalid Tabix preset format flags ${i}`);let r={ref:e.readInt32LE(t+4),start:e.readInt32LE(t+8),end:e.readInt32LE(t+12)},a=e.readInt32LE(t+16),s=a?String.fromCharCode(a):null,l=e.readInt32LE(t+20),o=e.readInt32LE(t+24),{refIdToName:d,refNameToId:h}=this._parseNameBytes(e.slice(t+28,t+28+o));return{refIdToName:d,refNameToId:h,skipLines:l,metaChar:s,columnNumbers:r,format:n,coordinateType:65536&i?"zero-based-half-open":"1-based-closed"}}_parseNameBytes(e){let t=0,i=0,n=[],r={};for(let a=0;a<e.length;a+=1)if(!e[a]){if(i<a){let s=e.toString("utf8",i,a);s=this.renameRefSeq(s),n[t]=s,r[s]=t}i=a+1,t+=1}return{refNameToId:r,refIdToName:n}}async _parse(e={}){let t,i;let n=await (0,o.unzip)(await this.filehandle.readFile(e));if(0x1495343===n.readUInt32LE(0))t=1;else if(0x2495343===n.readUInt32LE(0))t=2;else throw Error("Not a CSI file");this.minShift=n.readInt32LE(4),this.depth=n.readInt32LE(8),this.maxBinNumber=((1<<(this.depth+1)*3)-1)/7;let r=2**(this.minShift+3*this.depth),a=n.readInt32LE(12),s=a&&a>=30?this.parseAuxData(n,16):{refIdToName:[],refNameToId:{},metaChar:null,columnNumbers:{ref:0,start:1,end:2},coordinateType:"zero-based-half-open",format:"generic"},l=n.readInt32LE(16+a),d=16+a+4,h=Array(l).fill(0).map(()=>{let e;let t=n.readInt32LE(d);d+=4;let r={};for(let a=0;a<t;a+=1){let t=n.readUInt32LE(d);if(t>this.maxBinNumber)e=this.parsePseudoBin(n,d+4),d+=48;else{let e=x(n,d+4);i=this._findFirstData(i,e);let a=n.readInt32LE(d+12);d+=16;let s=Array(a);for(let e=0;e<a;e+=1){let i=x(n,d),r=x(n,d+8);d+=16,s[e]=new b(i,r,t)}r[t]=s}}return{binIndex:r,stats:e}});return{...s,csi:!0,refCount:l,maxBlockSize:65536,firstDataLine:i,csiVersion:t,indices:h,depth:this.depth,maxBinNumber:this.maxBinNumber,maxRefLength:r}}parsePseudoBin(e,t){return{lineCount:d(m().fromBytesLE(e.slice(t+28,t+36),!0))}}async blocksForRange(e,t,i,n={}){t<0&&(t=0);let r=await this.parse(n),a=r.refNameToId[e];if(void 0===a)return[];let s=r.indices[a];if(!s)return[];let l=this.reg2bins(t,i),o=[];for(let[e,t]of l)for(let i=e;i<=t;i++)if(s.binIndex[i])for(let e of s.binIndex[i])o.push(new b(e.minv,e.maxv,i));return c(o,new p(0,0))}reg2bins(e,t){var i;(e-=1)<1&&(e=1),t>0x4000000000000&&(t=0x400000000),t-=1;let n=0,r=0,a=this.minShift+3*this.depth,s=[];for(;n<=this.depth;a-=3,r+=(i=3*n,1*2**i),n+=1){let i=r+v(e,a),n=r+v(t,a);if(n-i+s.length>this.maxBinNumber)throw Error(`query ${e}-${t} is too large for current binning scheme (shift ${this.minShift}, depth ${this.depth}), try a smaller query or a coarser index binning scheme`);s.push([i,n])}return s}}let I="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;class y{constructor({path:e,filehandle:t,url:i,tbiPath:r,tbiUrl:s,tbiFilehandle:o,csiPath:d,csiUrl:h,csiFilehandle:f,renameRefSeqs:c=e=>e,chunkCacheSize:u=5242880}){if(t)this.filehandle=t;else if(e)this.filehandle=new l.LocalFile(e);else if(i)this.filehandle=new l.RemoteFile(i);else throw TypeError("must provide either filehandle or path");if(o)this.index=new g({filehandle:o,renameRefSeqs:c});else if(f)this.index=new E({filehandle:f,renameRefSeqs:c});else if(r)this.index=new g({filehandle:new l.LocalFile(r),renameRefSeqs:c});else if(d)this.index=new E({filehandle:new l.LocalFile(d),renameRefSeqs:c});else if(e)this.index=new g({filehandle:new l.LocalFile(`${e}.tbi`),renameRefSeqs:c});else if(h)this.index=new E({filehandle:new l.RemoteFile(h)});else if(s)this.index=new g({filehandle:new l.RemoteFile(s)});else if(i)this.index=new g({filehandle:new l.RemoteFile(`${i}.tbi`)});else throw TypeError("must provide one of tbiFilehandle, tbiPath, csiFilehandle, csiPath, tbiUrl, csiUrl");this.renameRefSeq=c,this.chunkCache=new n.A({cache:new(a())({maxSize:Math.floor(u/65536)}),fill:(e,t)=>this.readChunk(e,{signal:t})})}async getLines(e,t,i,n){var r,a;let s,l;let o={};"function"==typeof n?l=n:(o=n,l=n.lineCallback,s=n.signal);let d=await this.index.getMetadata(o);f(s);let h=null!=t?t:0,c=null!=i?i:d.maxRefLength;if(!(h<=c))throw TypeError("invalid start and end coordinates. start must be less than or equal to end");if(h===c)return;let u=await this.index.blocksForRange(e,h,c,o);for(let t of(f(s),u)){let{buffer:i,cpositions:n,dpositions:o}=await this.chunkCache.get(t.toString(),t,s);f(s);let u=0,m=0,p=null!==(r=null==I?void 0:I.decode(i))&&void 0!==r?r:i.toString(),x=i.length<5e8&&/^[\u0000-\u007F]*$/.test(p);for(;u<p.length;){let r,s;if(x){if(-1===(s=p.indexOf("\n",u)))break;r=p.slice(u,s)}else{if(-1===(s=i.indexOf("\n",u)))break;let e=i.slice(u,s);r=null!==(a=null==I?void 0:I.decode(e))&&void 0!==a?a:e.toString()}if(o){for(;u+t.minv.dataPosition>=o[m++];);m--}let{startCoordinate:f,overlaps:b}=this.checkLine(d,e,h,c,r);if(b)l(r,256*n[m]+(u-o[m])+t.minv.dataPosition+1);else if(void 0!==f&&f>=c)return;u=s+1}}}async getMetadata(e={}){return this.index.getMetadata(e)}async getHeaderBuffer(e={}){let{firstDataLine:t,metaChar:i,maxBlockSize:n}=await this.getMetadata(e);f(e.signal);let r=((null==t?void 0:t.blockPosition)||0)+n,a=await this._readRegion(0,r,e),s=await (0,o.unzip)(a);if(i){let e=-1,t=i.charCodeAt(0);for(let i=0;i<s.length&&(i!==e+1||s[i]===t);i+=1)10===s[i]&&(e=i);return s.subarray(0,e+1)}return s}async getHeader(e={}){return(await this.getHeaderBuffer(e)).toString("utf8")}async getReferenceSequenceNames(e={}){return(await this.getMetadata(e)).refIdToName}checkLine(e,t,i,n,r){let{columnNumbers:a,metaChar:s,coordinateType:l,format:o}=e;if(s&&r.startsWith(s))return{overlaps:!1};let{ref:d,start:h,end:f}=a;d||(d=0),h||(h=0),f||(f=0),"VCF"===o&&(f=8);let c=Math.max(d,h,f),u=1,m=0,p="",x=-1/0,b=r.length;for(let e=0;e<b+1;e++)if("	"===r[e]||e===b){if(u===d){if(this.renameRefSeq(r.slice(m,e))!==t)return{overlaps:!1}}else if(u===h){if(x=parseInt(r.slice(m,e),10),"1-based-closed"===l&&(x-=1),x>=n||(0===f||f===h)&&x+1<=i)return{startCoordinate:x,overlaps:!1}}else if("VCF"===o&&4===u)p=r.slice(m,e);else if(u===f&&("VCF"===o?this._getVcfEnd(x,p,r.slice(m,e)):Number.parseInt(r.slice(m,e),10))<=i)return{overlaps:!1};if(m=e+1,(u+=1)>c)break}return{startCoordinate:x,overlaps:!0}}_getVcfEnd(e,t,i){let n=e+t.length,r=i.includes("SVTYPE=TRA");if("."===i[0]||r){if(r)return e+1}else{let e=";";for(let t=0;t<i.length;t+=1){if(";"===e&&"END="===i.slice(t,t+4)){let e=i.indexOf(";",t);-1===e&&(e=i.length),n=parseInt(i.slice(t+4,e),10);break}e=i[t]}}return n}async lineCount(e,t={}){return this.index.lineCount(e,t)}async _readRegion(e,t,i={}){let n=s.Buffer.alloc(t),{bytesRead:r,buffer:a}=await this.filehandle.read(n,0,t,e,i);return a.subarray(0,r)}async readChunk(e,t={}){let i=await this._readRegion(e.minv.blockPosition,e.fetchedSize(),t);return(0,o.unzipChunkSlice)(i,e)}}}}]);
//# sourceMappingURL=1682.ffa6dfdc0ec8552d.js.map