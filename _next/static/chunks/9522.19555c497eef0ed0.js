"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9522],{79522:(e,t,r)=>{r.d(t,{C:()=>I,j:()=>U});let i=BigInt(32);"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(e,t){return function(e,t,r){let a=Number(!!r),n=Number(!r);return BigInt(e.getInt32(t,r)*n+e.getInt32(t+4,r)*a)<<i|BigInt(e.getUint32(t,r)*a+e.getUint32(t+4,r)*n)}(this,e,t)}),"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(e,t){return function(e,t,r){let a=e.getUint32(t,r),n=e.getUint32(t+4,r),l=Number(!!r),s=Number(!r);return BigInt(a*s+n*l)<<i|BigInt(a*l+n*s)}(this,e,t)});var a=r(75927),n=r(28126),l=r(68134),s=r.n(l);class g{constructor(e){this.ranges=e}get min(){return this.ranges[0].min}get max(){return this.ranges.at(-1).max}contains(e){for(let t of this.ranges)if(t.min<=e&&t.max>=e)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map(e=>new g([{min:e.min,max:e.max}]))}toString(){return this.ranges.map(e=>`[${e.min}-${e.max}]`).join(",")}union(e){let t=[...this.getRanges(),...e.getRanges()].sort((e,t)=>e.min<t.min?-1:e.min>t.min?1:e.max<t.max?-1:t.max>e.max?1:0),r=[],i=t[0];for(let e of t)e.min>i.max+1?(r.push(i),i=e):e.max>i.max&&(i=new g([{min:i.min,max:e.max}]));return r.push(i),1===r.length?r[0]:new g(r)}}var f=r(71437);class o extends Error{constructor(e){super(e),this.code="ERR_ABORTED"}}function u(e){if(e&&e.aborted){if("undefined"==typeof DOMException){let e=new o("aborted");throw e.code="ERR_ABORTED",e}throw new DOMException("aborted","AbortError")}}let h="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;class c{constructor(e,t,r,i,l,g){if(this.bbi=e,this.refsByName=t,this.cirTreeOffset=r,this.isBigEndian=i,this.isCompressed=l,this.blockType=g,this.featureCache=new n.A({cache:new(s())({maxSize:1e3}),fill:async(e,t)=>{let r=e.length,i=e.offset,{buffer:n}=await this.bbi.read(a.Buffer.alloc(r),0,r,i,{signal:t});return n}}),!(r>=0))throw Error("invalid cirTreeOffset!")}async readWigData(e,t,r,i,n){try{let{refsByName:l,bbi:s,cirTreeOffset:f,isBigEndian:o}=this,u=l[e];void 0===u&&i.complete();let h={chrId:u,start:t,end:r};this.cirTreePromise||(this.cirTreePromise=s.read(a.Buffer.alloc(48),0,48,f,n));let{buffer:c}=await this.cirTreePromise,b=o?c.readUInt32BE(4):c.readUInt32LE(4),d=[],m=0,w=(e,t,r)=>{try{let i=e.subarray(t),a=new DataView(i.buffer,i.byteOffset,i.length),n=0,l=a.getUint8(n);n+=2;let s=a.getUint16(n,!0);if(n+=2,1===l){let e=[];for(let t=0;t<s;t++){let t=a.getUint32(n,!0);n+=4;let r=a.getUint32(n,!0);n+=4;let i=a.getUint32(n,!0);n+=4;let l=a.getUint32(n,!0);n+=4;let s=Number(a.getBigUint64(n,!0));n+=8;let g=Number(a.getBigUint64(n,!0));n+=8,e.push({startChrom:t,startBase:r,endBase:l,endChrom:i,blockOffset:s,blockSize:g,offset:n})}d=d.concat(e.filter(e=>y(e)).map(e=>({offset:e.blockOffset,length:e.blockSize})))}else if(0===l){let e=[];for(let t=0;t<s;t++){let t=a.getUint32(n,!0);n+=4;let r=a.getUint32(n,!0);n+=4;let i=a.getUint32(n,!0);n+=4;let l=a.getUint32(n,!0);n+=4;let s=Number(a.getBigUint64(n,!0));n+=8,e.push({startChrom:t,startBase:r,endChrom:i,endBase:l,blockOffset:s,offset:n})}let t=e.filter(e=>y(e)).map(e=>e.blockOffset);t.length>0&&B(t,r+1)}}catch(e){i.error(e)}},y=e=>{let{startChrom:i,startBase:a,endChrom:n,endBase:l}=e;return(i<u||i===u&&a<=r)&&(n>u||n===u&&l>=t)},U=async(e,t,r)=>{try{let a=t.max-t.min,l=t.min,s=await this.featureCache.get(`${a}_${l}`,{length:a,offset:l},null==n?void 0:n.signal);for(let a of e)t.contains(a)&&(w(s,a-l,r),m-=1,0===m&&this.readFeatures(i,d,{...n,request:h}).catch(e=>{i.error(e)}))}catch(e){i.error(e)}},B=(e,t)=>{try{m+=e.length;let r=4+32*b,i=new g([{min:e[0],max:e[0]+r}]);for(let t=1;t<e.length;t+=1){let a=new g([{min:e[t],max:e[t]+r}]);i=i.union(a)}i.getRanges().map(r=>U(e,r,t))}catch(e){i.error(e)}};B([Number(f)+48],1);return}catch(e){i.error(e)}}parseSummaryBlock(e,t,r){let i=[],a=t,n=new DataView(e.buffer,e.byteOffset,e.length);for(;a<e.byteLength;){var l;let e=n.getUint32(a,!0);a+=4;let t=n.getUint32(a,!0);a+=4;let s=n.getUint32(a,!0);a+=4;let g=n.getUint32(a,!0);a+=4;let f=n.getFloat32(a,!0);a+=4;let o=n.getFloat32(a,!0);a+=4;let u=n.getFloat32(a,!0);a+=4,a+=4,(!r||e===r.chrId&&(l=r.start,t<r.end&&s>=l))&&i.push({start:t,end:s,maxScore:o,minScore:f,summary:!0,score:u/(g||1)})}return i}parseBigBedBlock(e,t,r,i){var a;let n=[],l=t,s=new DataView(e.buffer,e.byteOffset,e.length);for(;l<e.byteLength;){let t=l,i=s.getUint32(l,!0);l+=4;let g=s.getInt32(l,!0);l+=4;let f=s.getInt32(l,!0),o=l+=4;for(;o<e.length&&0!==e[o];o++);let u=e.subarray(l,o),c=null!==(a=null==h?void 0:h.decode(u))&&void 0!==a?a:u.toString();l=o+1,n.push({chromId:i,start:g,end:f,rest:c,uniqueId:`bb-${r+t}`})}return i?n.filter(e=>{var t,r,a;return t=e.start,r=e.end,a=i.start,t<i.end&&r>=a}):n}parseBigWigBlock(e,t,r){let i;let a=e.subarray(t),n=new DataView(a.buffer,a.byteOffset,a.length);i=4;let l=n.getInt32(i,!0);i+=8;let s=n.getUint32(i,!0);i+=4;let g=n.getUint32(i,!0);i+=4;let f=n.getUint8(i);i+=2;let o=n.getUint16(i,!0);i+=2;let u=Array(o);switch(f){case 1:for(let e=0;e<o;e++){let t=n.getInt32(i,!0);i+=4;let r=n.getInt32(i,!0);i+=4;let a=n.getFloat32(i,!0);i+=4,u[e]={start:t,end:r,score:a}}break;case 2:for(let e=0;e<o;e++){let t=n.getInt32(i,!0);i+=4;let r=n.getFloat32(i,!0);i+=4,u[e]={score:r,start:t,end:t+g}}break;case 3:for(let e=0;e<o;e++){let t=n.getFloat32(i,!0);i+=4;let r=l+e*s;u[e]={score:t,start:r,end:r+g}}}return r?u.filter(e=>{var t,i,a;return t=e.start,i=e.end,a=r.start,t<r.end&&i>=a}):u}async readFeatures(e,t,r={}){try{let{blockType:i,isCompressed:a}=this,{signal:n,request:l}=r,s=function(e){let t,r;e.sort((e,t)=>e.offset-t.offset);let i=[];for(let a of e)t&&r&&a.offset-r<=2e3?(t.length=t.length+a.length-r+a.offset,t.blocks.push(a)):i.push(t={blocks:[a],length:a.length,offset:a.offset}),r=t.offset+t.length;return i}(t);u(n),await Promise.all(s.map(async t=>{u(n);let{length:r,offset:s}=t,g=await this.featureCache.get(`${r}_${s}`,t,n);for(let r of t.blocks){u(n);let s=Number(r.offset)-Number(t.offset),h=g;if(a){var o;o=g.subarray(s),h=(0,f.wS)(o.subarray(2)),s=0}switch(u(n),i){case"summary":e.next(this.parseSummaryBlock(h,s,l));break;case"bigwig":e.next(this.parseBigWigBlock(h,s,l));break;case"bigbed":e.next(this.parseBigBedBlock(h,s,256*Number(r.offset),l));break;default:console.warn(`Don't know what to do with ${i}`)}}})),e.complete()}catch(t){e.error(t)}}}var b=r(82485),d=r(84612),m=r(90287),w=r(18998);class y{getHeader(e){return this.headerP||(this.headerP=this._getHeader(e).catch(e=>{throw this.headerP=void 0,e})),this.headerP}constructor(e){let{filehandle:t,renameRefSeqs:r=e=>e,path:i,url:a}=e;if(this.renameRefSeqs=r,t)this.bbi=t;else if(a)this.bbi=new b.RemoteFile(a);else if(i)this.bbi=new b.LocalFile(i);else throw Error("no file given")}async _getHeader(e){let t=await this._getMainHeader(e),r=await this._readChromTree(t,e);return{...t,...r}}async _getMainHeader(e,t=2e3){let r;let{buffer:i}=await this.bbi.read(a.Buffer.alloc(t),0,t,0,e),n=this._isBigEndian(i),l=new DataView(i.buffer,i.byteOffset,i.length),s=0,g=l.getInt32(s,!0);s+=4;let f=l.getUint16(s,!0);s+=2;let o=l.getUint16(s,!0);s+=2;let u=Number(l.getBigUint64(s,!0));s+=8;let h=Number(l.getBigUint64(s,!0));s+=8;let c=Number(l.getBigUint64(s,!0));s+=8;let b=l.getUint16(s,!0);s+=2;let d=l.getUint16(s,!0);s+=2;let m=Number(l.getBigUint64(s,!0));s+=8;let w=Number(l.getBigUint64(s,!0));s+=8;let y=l.getUint32(s,!0);s+=4;let U=Number(l.getBigUint64(s,!0));s+=8;let B=[];for(let e=0;e<o;e++){let e=l.getUint32(s,!0);s+=4;let t=l.getUint32(s,!0);s+=4;let r=Number(l.getBigUint64(s,!0));s+=8;let i=Number(l.getBigUint64(s,!0));s+=8,B.push({reductionLevel:e,reserved:t,dataOffset:r,indexOffset:i})}if(m>t||w>t-40)return this._getMainHeader(e,2*t);if(w){let e=i.subarray(Number(w)),t=0,a=new DataView(e.buffer,e.byteOffset,e.length),n=Number(a.getBigUint64(t,!0));t+=8;let l=a.getFloat64(t,!0);t+=8;let s=a.getFloat64(t,!0);t+=8;let g=a.getFloat64(t,!0);t+=8;let f=a.getFloat64(t,!0);t+=8,r={scoreMin:l,scoreMax:s,scoreSum:g,scoreSumSquares:f,basesCovered:n}}else throw Error("no stats");return{zoomLevels:B,magic:g,extHeaderOffset:U,numZoomLevels:o,fieldCount:b,totalSummary:r,definedFieldCount:d,uncompressBufSize:y,asOffset:m,chromTreeOffset:u,totalSummaryOffset:w,unzoomedDataOffset:h,unzoomedIndexOffset:c,fileType:-0x78760d15===g?"bigbed":"bigwig",version:f,isBigEndian:n,autoSql:m?i.subarray(m,i.indexOf(0,m)).toString():""}}_isBigEndian(e){let t=e.readInt32LE(0);if(-0x777003da===t||-0x78760d15===t)return!1;if(-0x777003da===(t=e.readInt32BE(0))||-0x78760d15===t)return!0;throw Error("not a BigWig/BigBed file")}async _readChromTree(e,t){let r;let i=!e.isBigEndian,n=[],l={},s=e.unzoomedDataOffset,g=e.chromTreeOffset;for(;s%4!=0;)s+=1;let f=s-g,{buffer:o}=await this.bbi.read(a.Buffer.alloc(f),0,f,Number(g),t),u=new DataView(o.buffer,o.byteOffset,o.length);r=8;let h=u.getUint32(r,i);r+=16;let c=async e=>{let t=e;if(t>=o.length)throw Error("reading beyond end of buffer");let r=u.getUint8(t);t+=2;let a=u.getUint16(t,i);if(t+=2,r)for(let e=0;e<a;e++){let e=o.subarray(t,t+h).toString().replaceAll("\0","");t+=h;let r=u.getUint32(t,i);t+=4;let a=u.getUint32(t,i);t+=4;let s={name:e,id:r,length:a};l[this.renameRefSeqs(e)]=r,n[r]=s}else{let e=[];for(let r=0;r<a;r++){t+=h;let r=Number(u.getBigUint64(t,i));t+=8,e.push(c(Number(r)-Number(g)))}await Promise.all(e)}};return await c(32),{refsByName:l,refsByNumber:n}}async getUnzoomedView(e){let{unzoomedIndexOffset:t,refsByName:r,uncompressBufSize:i,isBigEndian:a,fileType:n}=await this.getHeader(e);return new c(this.bbi,r,t,a,i>0,n)}async getFeatureStream(e,t,r,i){let a;await this.getHeader(i);let n=this.renameRefSeqs(e),{basesPerSpan:l,scale:s}=i||{};return a=l?await this.getView(1/l,i):s?await this.getView(s,i):await this.getView(1,i),new d.c(e=>{a.readWigData(n,t,r,e,i).catch(t=>{e.error(t)})})}async getFeatures(e,t,r,i){let a=await this.getFeatureStream(e,t,r,i);return(await (0,m._)(a.pipe((0,w.$)()))).flat()}}class U extends y{async getView(e,t){let{zoomLevels:r,refsByName:i,isBigEndian:a,uncompressBufSize:n}=await this.getHeader(t),l=1/e,s=r.length-1;for(let e=s;e>=0;e-=1){let t=r[e];if(t&&t.reductionLevel<=2*l)return new c(this.bbi,i,t.indexOffset,a,n>0,"summary")}return this.getUnzoomedView(t)}}var B=r(49208),p=r(84761),x=r(31190);class I extends y{constructor(){super(...arguments),this.readIndicesCache=new n.A({cache:new(s())({maxSize:1}),fill:(e,t)=>this._readIndices({...e,signal:t})})}readIndices(e={}){let{signal:t,...r}=e;return this.readIndicesCache.get(JSON.stringify(r),e,t)}async getView(e,t){return this.getUnzoomedView(t)}async _readIndices(e){let t;let{extHeaderOffset:r,isBigEndian:i}=await this.getHeader(e),{buffer:n}=await this.bbi.read(a.Buffer.alloc(64),0,64,Number(r)),l=!i,s=new DataView(n.buffer,n.byteOffset,n.length);t=2;let g=s.getUint16(t,l);t+=2;let f=Number(s.getBigUint64(t,l));if(t+=8,0===g)return[];let o=20*g,{buffer:u}=await this.bbi.read(a.Buffer.alloc(o),0,o,Number(f)),h=[];for(let e=0;e<g;e+=1){let t=u.subarray(20*e),r=new DataView(t.buffer,t.byteOffset,t.length),i=0,a=r.getInt16(i,l);i+=2;let n=r.getInt16(i,l);i+=2;let s=Number(r.getBigUint64(i,l));i+=12;let g=r.getInt16(i,l);h.push({type:a,fieldcount:n,offset:Number(s),field:g})}return h}async searchExtraIndexBlocks(e,t={}){let{isBigEndian:r}=await this.getHeader(t),i=await this.readIndices(t);if(0===i.length)return[];let n=i.map(async i=>{let n;let{offset:l,field:s}=i,{buffer:g}=await this.bbi.read(a.Buffer.alloc(32),0,32,l,t),f=!r,o=new DataView(g.buffer,g.byteOffset,g.length);n=4;let u=o.getInt32(n,f);n+=4;let h=o.getInt32(n,f);n+=4;let c=o.getInt32(n,f);n+=12;let b=async r=>{let i=Number(r),n=4+u*(h+c),{buffer:l}=await this.bbi.read(a.Buffer.alloc(n),0,n,i,t),g=new DataView(l.buffer,l.byteOffset,l.length),o=0,d=g.getInt8(o);o+=2;let m=g.getInt16(o,f);o+=2;let w=[];if(0===d){let t=[];for(let e=0;e<m;e++){let e=l.subarray(o,o+h).toString().replaceAll("\0","");o+=h;let r=Number(g.getBigUint64(o,f));o+=8,t.push({key:e,offset:r})}let r=0;for(let{key:i,offset:a}of t){if(0>e.localeCompare(i)&&r)break;r=a}return b(r)}if(1===d){for(let e=0;e<m;e++){let e=l.subarray(o,o+h).toString().replaceAll("\0","");o+=h;let t=Number(g.getBigUint64(o,f));o+=8;let r=g.getUint32(o,f);o+=4;let i=g.getUint32(o,f);o+=4,w.push({key:e,offset:t,length:r,reserved:i})}for(let t of w)if(t.key===e)return{...t,field:s};return}};return b(l+32)});return(await Promise.all(n)).filter(e=>!!e)}async searchExtraIndex(e,t={}){let r=await this.searchExtraIndexBlocks(e,t);if(0===r.length)return[];let i=await this.getUnzoomedView(t),a=r.map(e=>new d.c(r=>{i.readFeatures(r,[e],t).catch(e=>{r.error(e)})}).pipe((0,p.T)((e,t)=>e.concat(t)),(0,x.T)(t=>{for(let r of t)r.field=e.field;return t})));return(await (0,m._)((0,B.h)(...a))).filter(t=>{var r;return(null===(r=t.rest)||void 0===r?void 0:r.split("	")[(t.field||0)-3])===e})}}}}]);
//# sourceMappingURL=9522.19555c497eef0ed0.js.map