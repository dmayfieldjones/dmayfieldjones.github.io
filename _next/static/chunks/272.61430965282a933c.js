"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[272],{272:(e,t,r)=>{r.d(t,{makeImageData:()=>m});var l=r(53394),o=r(47204),n=r(28251),i=r(71843),a=r(39554),c=r(54262),f=r(46042);function s(e,t,r,l,o,n,i){t+l<0||t>n||(i&&(e.fillStyle=i),e.fillRect(t,r,l,o))}function _(e){let{bases:t}=e.palette;return{A:t.A.main,C:t.C.main,G:t.G.main,T:t.T.main,deletion:"#808080"}}function p(){return{charWidth:(0,c.measureText)("A"),charHeight:(0,c.measureText)("M")-2}}var d=r(10521),u=r(50324),g=r(94871),h=r(87206);function m({ctx:e,layoutRecords:t,canvasWidth:r,renderArgs:m}){let{stopToken:b,config:v,showSoftClip:T,colorBy:w,theme:x}=m,C=(0,l.readConfObject)(v,"mismatchAlpha"),S=(0,l.readConfObject)(v,"minSubfeatureWidth"),y=(0,l.readConfObject)(v,"largeInsertionIndicatorScale"),M=(0,l.readConfObject)(v,"hideSmallIndels"),P="#f0f"===(0,l.readConfObject)(v,"color"),A=(0,o.createJBrowseTheme)(x),k=_(A),R=Object.fromEntries(Object.entries(_(A)).map(([e,t])=>[e,A.palette.getContrastText(t)]));e.font="bold 10px Courier New,monospace";let{charWidth:O,charHeight:I}=p(),L=["methylation","modifications"].includes((null==w?void 0:w.type)||""),D=performance.now();for(let o of t)performance.now()-D>400&&((0,n.checkStopToken)(b),D=performance.now()),function({ctx:e,feat:t,renderArgs:r,colorForBase:o,contrastForBase:n,charWidth:_,charHeight:p,defaultColor:m,canvasWidth:b}){let{config:v,bpPerPx:T,regions:w,colorBy:x,colorTagMap:C={}}=r,{tag:S="",type:y=""}=x||{},{feature:M}=t,P=w[0];switch(e.fillStyle=function({colorType:e,tag:t,feature:r,config:o,defaultColor:n,colorTagMap:c}){switch(e){case"insertSize":return r.get("is_paired")&&r.get("refName")!==r.get("next_ref")?"#555":`hsl(${Math.abs(r.get("template_length"))/10},50%,50%)`;case"strand":return -1===r.get("strand")?"#8F8FD8":"#EC8B8B";case"mappingQuality":return`hsl(${r.get("score")},50%,50%)`;case"pairOrientation":return i.pf[function(e,t){let r=(0,l.readConfObject)(t,"orientationType");return({LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"})[a.il[r][e.get("pair_orientation")]]}(r,o)||"color_nostrand"];case"stranded":return i.pf[function(e){let t=e.get("flags"),r=e.get("strand");if(1&t){let l=64&t?-1:1;return 2&t?r*l==1?"color_rev_strand":"color_fwd_strand":8&t?r*l==1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_ref")?r*l==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(r)];case"xs":case"tag":{let e=r.get("tags"),l=e?e[t]:r.get(t);if("XS"===t||"TS"===t){if("-"===l)return i.pf.color_rev_strand;if("+"===l)return i.pf.color_fwd_strand;return i.pf.color_nostrand}if("ts"===t){if("-"===l)return -1===r.get("strand")?i.pf.color_fwd_strand:i.pf.color_rev_strand;if("+"===l)return -1===r.get("strand")?i.pf.color_rev_strand:i.pf.color_fwd_strand;return i.pf.color_nostrand}return c[l]||i.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return n?"lightgrey":(0,l.readConfObject)(o,"color",{feature:r})}}({feature:M,config:v,tag:S,defaultColor:m,colorType:y,colorTagMap:C}),function({ctx:e,feat:t,renderArgs:r}){let{regions:l,bpPerPx:o}=r,{heightPx:n,topPx:i,feature:a}=t,s=l[0],_=a.get("start"),p=a.get("end"),d=a.get("CIGAR"),u=s.reversed?-1:1,g=a.get("strand")*u,h=o<10&&n>5;if(null==d?void 0:d.includes("N")){let t=(0,f.eL)(d);if(1===g){let r=0,l=_;for(let a=0;a<t.length;a+=2){let f=+t[a],_=t[a+1];if("M"===_||"X"===_||"="===_||"D"===_)r+=f;else if("N"===_){if(l!==r){let[t,a]=(0,c.bpSpanPx)(l,l+r,s,o),f=a-t;e.fillRect(t,i,f,n)}l+=r+f,r=0}}if(l!==r){let[t,a]=(0,c.bpSpanPx)(l,l+r,s,o),f=a-t;h?(e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+n),e.lineTo(a,i+n),e.lineTo(a+5,i+n/2),e.lineTo(a,i),e.closePath(),e.fill()):e.fillRect(t,i,f,n)}}else if(-1===g){let r=0,l=p;for(let a=t.length-2;a>=0;a-=2){let f=+t[a],_=t[a+1];if("M"===_||"X"===_||"="===_||"D"===_)r+=f;else if("N"===_){if(0!==r){let[t,a]=(0,c.bpSpanPx)(l-r,l,s,o);e.fillRect(t,i,a-t,n)}l-=r+f,r=0}}if(0!==r){let[t,a]=(0,c.bpSpanPx)(l-r,l,s,o),f=a-t;h?(e.beginPath(),e.moveTo(t-5,i+n/2),e.lineTo(t,i+n),e.lineTo(a,i+n),e.lineTo(a,i),e.lineTo(t,i),e.closePath(),e.fill()):e.fillRect(t,i,f,n)}}}else{let[t,r]=(0,c.bpSpanPx)(_,p,s,o);o<10&&n>5?(-1===g?(e.beginPath(),e.moveTo(t-5,i+n/2),e.lineTo(t,i+n),e.lineTo(r,i+n),e.lineTo(r,i),e.lineTo(t,i)):(e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+n),e.lineTo(r,i+n),e.lineTo(r+5,i+n/2),e.lineTo(r,i)),e.closePath(),e.fill()):e.fillRect(t,i,r-t,n)}}({ctx:e,feat:t,renderArgs:r}),y){case"perBaseQuality":!function({ctx:e,feat:t,region:r,bpPerPx:l,canvasWidth:o,cigarOps:n}){let{feature:i,topPx:a,heightPx:f}=t,_=(i.get("qual")||"").split(" ").map(e=>+e),p=1/l,d=i.get("start"),u=0,g=0;for(let t=0;t<n.length;t+=2){let i=+n[t],h=n[t+1];if("S"===h||"I"===h)u+=i;else if("D"===h||"N"===h)g+=i;else if("M"===h||"X"===h||"="===h){for(let t=0;t<i;t++){let n=_[u+t],i=d+g+t;s(e,(0,c.bpSpanPx)(i,i+1,r,l)[0],a,p+.5,f,o,`hsl(${255===n?150:1.5*n},55%,50%)`)}u+=i,g+=i}}}({ctx:e,feat:t,region:P,bpPerPx:T,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))});break;case"perBaseLettering":!function({ctx:e,feat:t,region:r,bpPerPx:l,colorForBase:o,contrastForBase:n,charWidth:i,charHeight:a,canvasWidth:f,cigarOps:_}){let p=a-2,{feature:d,topPx:u,heightPx:g}=t,h=d.get("seq"),m=1/l,b=d.get("start"),v=0,T=0;if(h)for(let t=0;t<_.length;t+=2){let a=+_[t],d=_[t+1];if("S"===d||"I"===d)v+=a;else if("D"===d||"N"===d)T+=a;else if("M"===d||"X"===d||"="===d){for(let t=0;t<a;t++){let a=h[v+t],_=b+T+t,[d]=(0,c.bpSpanPx)(_,_+1,r,l);s(e,d,u,m+.5,g,f,o[a]),m>=i&&g>=p&&(e.fillStyle=n[a],e.fillText(a,d+(m-i)/2+1,u+g))}v+=a,T+=a}}}({ctx:e,feat:t,region:P,bpPerPx:T,colorForBase:o,contrastForBase:n,charWidth:_,charHeight:p,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))});break;case"modifications":!function({ctx:e,feat:t,region:r,bpPerPx:l,renderArgs:o,canvasWidth:n,cigarOps:i}){var a,f,_;let{feature:p,topPx:g,heightPx:h}=t,{colorBy:m,visibleModifications:b={}}=o;if(!p.get("seq"))return;let v=p.get("start"),T=null===(a=null==m?void 0:m.modifications)||void 0===a?void 0:a.isolatedModification,w=null===(f=null==m?void 0:m.modifications)||void 0===f?void 0:f.twoColor;null===(_=(0,d.r)(p,i))||void 0===_||_.forEach(({allProbs:t,prob:o,type:i},a)=>{let f=v+a,[_,p]=(0,c.bpSpanPx)(f,f+1,r,l),d=b[i];if(!d){console.warn(`${i} not known yet`);return}if(T&&d.type!==T)return;let m=d.color||"black",x=1-(0,c.sum)(t);w&&x>(0,c.max)(t)?s(e,_,g,p-_+.5,h,n,(0,u.yr)("blue",x)):s(e,_,g,p-_+.5,h,n,(0,u.yr)(m,o))})}({ctx:e,feat:t,region:P,bpPerPx:T,renderArgs:r,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))});break;case"methylation":!function({ctx:e,feat:t,region:r,bpPerPx:l,renderArgs:o,canvasWidth:n,cigarOps:i}){let{regionSequence:a}=o,{feature:f,topPx:_,heightPx:p}=t;if(!a)throw Error("region sequence required for methylation");if(!f.get("seq"))return;let d=f.get("start"),u=f.get("end"),{methBins:m,methProbs:b,hydroxyMethBins:v,hydroxyMethProbs:T}=(0,h.Ps)(f,i);function w(e){if(m[e]){let t=b[e]||0;return(t>.5?(0,g.colord)("red").alpha((t-.5)*2):(0,g.colord)("blue").alpha(1-2*t)).toHslString()}if(v[e]){let t=T[e]||0;return(t>.5?(0,g.colord)("pink").alpha((t-.5)*2):(0,g.colord)("purple").alpha(1-2*t)).toHslString()}}let x=a.toLowerCase();for(let t=0;t<u-d;t++){let o=t+d,i=x[o-r.start+1],a=x[o-r.start+2];if("c"===i&&"g"===a){if(l>2){let[i,a]=(0,c.bpSpanPx)(o,o+2,r,l),f=a-i+.5;s(e,i,_,f,p,n,w(t)||w(t+1)||"blue")}else{let[i,a]=(0,c.bpSpanPx)(o,o+1,r,l),f=a-i+.5;s(e,i,_,f,p,n,w(t)||"blue");let[d,u]=(0,c.bpSpanPx)(o+1,o+2,r,l),g=u-d+.5;s(e,d,_,g,p,n,w(t+1)||"blue")}}}}({ctx:e,feat:t,region:P,bpPerPx:T,renderArgs:r,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))})}}({ctx:e,feat:o,renderArgs:m,defaultColor:P,colorForBase:k,contrastForBase:R,charWidth:O,charHeight:I,canvasWidth:r}),function({ctx:e,feat:t,renderArgs:r,minSubfeatureWidth:l,largeInsertionIndicatorScale:o,mismatchAlpha:n,charWidth:i,charHeight:a,colorForBase:f,contrastForBase:_,hideSmallIndels:p,canvasWidth:d,drawSNPsMuted:u,drawIndels:h=!0}){let{bpPerPx:m,regions:b}=r,{heightPx:v,topPx:T,feature:w}=t,x=b[0],C=w.get("start"),S=Math.min(1/m,2),y=w.get("mismatches"),M=a-2,P=x.reversed?1/m+1:-1;if(y){for(let t of y){let r=C+t.start,o=t.length,a=t.base,[b,w]=(0,c.bpSpanPx)(r,r+o,x,m),y=Math.max(l,w-b);if("mismatch"===t.type){if(!u){let r=f[t.base]||"#888";s(e,Math.round(b),T,y,v,d,n&&void 0!==t.qual?(0,g.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r)}if(y>=i&&v>=M){let r=u?"black":_[t.base]||"black";e.fillStyle=n&&void 0!==t.qual?(0,g.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r,e.fillText(a,b+(y-i)/2+1,T+v)}}else if("deletion"===t.type&&h){let r=t.length;if(!p||r>=10){s(e,b,T,Math.abs(b-w),v,d,f.deletion);let r=`${t.length}`,l=(0,c.measureText)(r,10);y>=l&&v>=M&&(e.fillStyle=_.deletion,e.fillText(r,(b+w)/2-l/2,T+v))}}else if("insertion"===t.type&&h){let r=b+P,l=+t.base||t.length,o=Math.max(0,Math.min(1.2,1/m));if(l<10&&!p&&(s(e,r,T,o,v,d,"purple"),1/m>=i&&v>=M)){let l=Math.round(r-o);s(e,l,T,3*o,1,d),s(e,l,T+v-1,3*o,1,d),e.fillText(`(${t.base})`,r+3,T+v)}}else if("hardclip"===t.type||"softclip"===t.type){let r=b+P,o="hardclip"===t.type?"red":"blue",n=Math.max(l,S);if(s(e,r,T,n,v,d,o),1/m>=i&&v>=M){let l=r-n;s(e,l,T,3*n,1,d),s(e,l,T+v-1,3*n,1,d),e.fillText(`(${t.base})`,r+3,T+v)}}else"skip"===t.type&&b+y>0&&s(e,Math.max(0,b),T+v/2-1,y-(m>10?1.5:0)+Math.min(b,0),1,d,"rgb(151,184,201)")}if(h)for(let t of y){let r=C+t.start,l=t.length,n=+t.base||t.length;if("insertion"===t.type&&n>=10){let[t]=(0,c.bpSpanPx)(r,r+l,x,m),i=`${n}`;if(m>o)s(e,t-1,T,2,v,d,"purple");else if(v>a){let r=(0,c.measureText)(i);s(e,t-r/2-5,T,r+10,v,d,"purple"),e.fillStyle="white",e.fillText(i,t-r/2,T+v)}else s(e,t-2,T,4,v,d,"purple")}}}}({ctx:e,feat:o,renderArgs:m,hideSmallIndels:M,mismatchAlpha:C,drawSNPsMuted:L,drawIndels:!0,largeInsertionIndicatorScale:y,minSubfeatureWidth:S,charWidth:O,charHeight:I,colorForBase:k,contrastForBase:R,canvasWidth:r}),T&&function({ctx:e,feat:t,renderArgs:r,config:o,theme:n,colorForBase:i,canvasWidth:a}){let{feature:_,topPx:d,heightPx:u}=t,{regions:g,bpPerPx:h}=r,m=g[0],b=(0,l.readConfObject)(o,"minSubfeatureWidth"),v=_.get("mismatches"),T=_.get("seq"),{charWidth:w,charHeight:x}=p();if(!(T&&v))return;let C=x-2,S=0,y=0,M=_.get("CIGAR"),P=(0,f.eL)(M);for(let t=0;t<P.length;t+=2){let r=P[t+1],l=+P[t];if("S"===r){for(let r=0;r<l;r++){let o=T[S+r],f=_.get("start")-(0===t?l:0)+y+r,[p,g]=(0,c.bpSpanPx)(f,f+1,m,h),v=Math.max(b,g-p),x=i[o]||"#000000";e.fillStyle=x,s(e,p,d,v,u,a),v>=w&&u>=C&&(e.fillStyle=n.palette.getContrastText(x),e.fillText(o,p+(v-w)/2+1,d+u))}S+=l}"N"===r&&(y+=l),("M"===r||"="===r||"X"===r)&&(y+=l,S+=l),"D"===r&&(y+=l),"I"===r&&(S+=l)}}({ctx:e,feat:o,renderArgs:m,colorForBase:k,config:v,theme:A,canvasWidth:r})}},71843:(e,t,r)=>{r.d(t,{DW:()=>s,L9:()=>i,pf:()=>o,sY:()=>c,w7:()=>n});var l=r(39554);let o={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},n={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function i(e,t,r){let l=e.refName===t.refName,i=Math.abs(e.tlen||0);return l&&i>((null==r?void 0:r.upper)||0)?[o.color_longinsert,n.color_longinsert]:l&&i<((null==r?void 0:r.lower)||0)?[o.color_shortinsert,n.color_shortinsert]:l?void 0:[o.color_interchrom,n.color_interchrom]}let a=[o.color_unknown,o.color_unknown];function c(e,t,r){return f(e)||i(e,t,r)||a}function f(e){let t=l.il.fr[e.pair_orientation||""],r=l.rr[t];return"LR"===t?void 0:[o[r],n[r]]}function s(e){return f(e)||a}},10521:(e,t,r)=>{r.d(t,{r:()=>a});var l=r(46042),o=r(65802),n=r(87206),i=r(39554);function a(e,t){let r=e.get("strand"),a=e.get("seq"),c=(0,i.c$)(e,"MM","Mm")||"",f=t||(0,l.eL)(e.get("CIGAR"));if(a){let t=(0,n.Z1)(c,a,r),l=(0,n.Yj)(e),i=[],s=0;for(let{type:e,positions:n}of t){for(let{ref:t,idx:a}of(0,o.h)(f,n)){let o=(null==l?void 0:l[s+(-1===r?n.length-1-a:a)])||0;if(i[t]){let r=i[t];i[t]={allProbs:[...r.allProbs,o],prob:Math.max(r.prob,o),type:r.prob>o?r.type:e}}else i[t]={type:e,prob:o,allProbs:[o]}}s+=n.length}return i}}}}]);
//# sourceMappingURL=272.61430965282a933c.js.map