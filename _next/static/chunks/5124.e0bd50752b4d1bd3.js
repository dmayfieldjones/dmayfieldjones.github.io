"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5124],{15508:(e,t,r)=>{r.d(t,{DW:()=>c,L9:()=>i,pf:()=>o,sY:()=>s,w7:()=>n});var l=r(9273);let o={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},n={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function i(e,t,r){let l=e.refName===t.refName,i=Math.abs(e.tlen||0);return l&&i>((null==r?void 0:r.upper)||0)?[o.color_longinsert,n.color_longinsert]:l&&i<((null==r?void 0:r.lower)||0)?[o.color_shortinsert,n.color_shortinsert]:l?void 0:[o.color_interchrom,n.color_interchrom]}let a=[o.color_unknown,o.color_unknown];function s(e,t,r){return f(e)||i(e,t,r)||a}function f(e){let t=l.il.fr[e.pair_orientation||""],r=l.rr[t];return"LR"===t?void 0:[o[r],n[r]]}function c(e){return f(e)||a}},29468:(e,t,r)=>{r.d(t,{r:()=>a});var l=r(86847),o=r(43057),n=r(25653),i=r(9273);function a(e,t){let r=e.get("strand"),a=e.get("seq"),s=(0,i.c$)(e,"MM","Mm")||"",f=t||(0,l.eL)(e.get("CIGAR"));if(a){let t=(0,n.Z1)(s,a,r),l=(0,n.Yj)(e),i=[],c=0;for(let{type:e,positions:n}of t){for(let{ref:t,idx:a}of(0,o.h)(f,n)){let o=(null==l?void 0:l[c+(-1===r?n.length-1-a:a)])||0;if(i[t]){let r=i[t];i[t]={allProbs:[...r.allProbs,o],prob:Math.max(r.prob,o),type:r.prob>o?r.type:e}}else i[t]={type:e,prob:o,allProbs:[o]}}c+=n.length}return i}}},55124:(e,t,r)=>{r.d(t,{makeImageData:()=>m});var l=r(88753),o=r(94029),n=r(64294),i=r(15508),a=r(9273),s=r(15715),f=r(86847);function c(e,t,r,l,o,n,i){t+l<0||t>n||(i&&(e.fillStyle=i),e.fillRect(t,r,l,o))}function _(e){let{skip:t,deletion:r,insertion:l,hardclip:o,softclip:n,bases:i}=e.palette;return{A:i.A.main,C:i.C.main,G:i.G.main,T:i.T.main,deletion:r,insertion:l,hardclip:o,softclip:n,skip:t}}function p(){return{charWidth:(0,s.measureText)("A"),charHeight:(0,s.measureText)("M")-2}}var d=r(29468),u=r(68821),g=r(18532),h=r(25653);function m({ctx:e,layoutRecords:t,canvasWidth:r,renderArgs:m}){let{stopToken:b,config:v,showSoftClip:T,colorBy:x,theme:C}=m,S=(0,l.readConfObject)(v,"mismatchAlpha"),w=(0,l.readConfObject)(v,"minSubfeatureWidth"),y=(0,l.readConfObject)(v,"largeInsertionIndicatorScale"),M=(0,l.readConfObject)(v,"hideSmallIndels"),P="#f0f"===(0,l.readConfObject)(v,"color"),A=(0,o.createJBrowseTheme)(C),k=_(A),R=Object.fromEntries(Object.entries(_(A)).map(([e,t])=>[e,A.palette.getContrastText(t)]));e.font="bold 10px Courier New,monospace";let{charWidth:O,charHeight:I}=p(),L=["methylation","modifications"].includes((null==x?void 0:x.type)||""),D=performance.now();for(let o of t)performance.now()-D>400&&((0,n.checkStopToken)(b),D=performance.now()),function({ctx:e,feat:t,renderArgs:r,colorMap:o,colorContrastMap:n,charWidth:_,charHeight:p,defaultColor:m,canvasWidth:b}){let{config:v,bpPerPx:T,regions:x,colorBy:C,colorTagMap:S={}}=r,{tag:w="",type:y=""}=C||{},{feature:M}=t,P=x[0];switch(e.fillStyle=function({colorType:e,tag:t,feature:r,config:o,defaultColor:n,colorTagMap:s}){switch(e){case"insertSize":return r.get("is_paired")&&r.get("refName")!==r.get("next_ref")?"#555":`hsl(${Math.abs(r.get("template_length"))/10},50%,50%)`;case"strand":return -1===r.get("strand")?"#8F8FD8":"#EC8B8B";case"mappingQuality":return`hsl(${r.get("score")},50%,50%)`;case"pairOrientation":return i.pf[function(e,t){let r=(0,l.readConfObject)(t,"orientationType");return({LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"})[a.il[r][e.get("pair_orientation")]]}(r,o)||"color_nostrand"];case"stranded":return i.pf[function(e){let t=e.get("flags"),r=e.get("strand");if(1&t){let l=64&t?-1:1;return 2&t?r*l==1?"color_rev_strand":"color_fwd_strand":8&t?r*l==1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_ref")?r*l==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(r)];case"xs":case"tag":{let e=r.get("tags"),l=e?e[t]:r.get(t);if("XS"===t||"TS"===t)if("-"===l)return i.pf.color_rev_strand;else if("+"===l)return i.pf.color_fwd_strand;else return i.pf.color_nostrand;if("ts"===t)if("-"===l)return -1===r.get("strand")?i.pf.color_fwd_strand:i.pf.color_rev_strand;else if("+"===l)return -1===r.get("strand")?i.pf.color_rev_strand:i.pf.color_fwd_strand;else return i.pf.color_nostrand;return s[l]||i.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return n?"lightgrey":(0,l.readConfObject)(o,"color",{feature:r})}}({feature:M,config:v,tag:w,defaultColor:m,colorType:y,colorTagMap:S}),!function({ctx:e,feat:t,renderArgs:r}){let{regions:l,bpPerPx:o}=r,{heightPx:n,topPx:i,feature:a}=t,c=l[0],_=a.get("start"),p=a.get("end"),d=a.get("CIGAR"),u=c.reversed?-1:1,g=a.get("strand")*u,h=o<10&&n>5;if(null==d?void 0:d.includes("N")){let t=(0,f.eL)(d);if(1===g){let r=0,l=_;for(let a=0;a<t.length;a+=2){let f=+t[a],_=t[a+1];if("M"===_||"X"===_||"="===_||"D"===_)r+=f;else if("N"===_){if(l!==r){let[t,a]=(0,s.bpSpanPx)(l,l+r,c,o),f=a-t;e.fillRect(t,i,f,n)}l+=r+f,r=0}}if(l!==r){let[t,a]=(0,s.bpSpanPx)(l,l+r,c,o),f=a-t;h?(e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+n),e.lineTo(a,i+n),e.lineTo(a+5,i+n/2),e.lineTo(a,i),e.closePath(),e.fill()):e.fillRect(t,i,f,n)}}else if(-1===g){let r=0,l=p;for(let a=t.length-2;a>=0;a-=2){let f=+t[a],_=t[a+1];if("M"===_||"X"===_||"="===_||"D"===_)r+=f;else if("N"===_){if(0!==r){let[t,a]=(0,s.bpSpanPx)(l-r,l,c,o);e.fillRect(t,i,a-t,n)}l-=r+f,r=0}}if(0!==r){let[t,a]=(0,s.bpSpanPx)(l-r,l,c,o),f=a-t;h?(e.beginPath(),e.moveTo(t-5,i+n/2),e.lineTo(t,i+n),e.lineTo(a,i+n),e.lineTo(a,i),e.lineTo(t,i),e.closePath(),e.fill()):e.fillRect(t,i,f,n)}}}else{let[t,r]=(0,s.bpSpanPx)(_,p,c,o);o<10&&n>5?(-1===g?(e.beginPath(),e.moveTo(t-5,i+n/2),e.lineTo(t,i+n),e.lineTo(r,i+n),e.lineTo(r,i),e.lineTo(t,i)):(e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+n),e.lineTo(r,i+n),e.lineTo(r+5,i+n/2),e.lineTo(r,i)),e.closePath(),e.fill()):e.fillRect(t,i,r-t,n)}}({ctx:e,feat:t,renderArgs:r}),y){case"perBaseQuality":!function({ctx:e,feat:t,region:r,bpPerPx:l,canvasWidth:o,cigarOps:n}){let{feature:i,topPx:a,heightPx:f}=t,_=(i.get("qual")||"").split(" ").map(e=>+e),p=1/l,d=i.get("start"),u=0,g=0;for(let t=0;t<n.length;t+=2){let i=+n[t],h=n[t+1];if("S"===h||"I"===h)u+=i;else if("D"===h||"N"===h)g+=i;else if("M"===h||"X"===h||"="===h){for(let t=0;t<i;t++){let n=_[u+t],i=d+g+t;c(e,(0,s.bpSpanPx)(i,i+1,r,l)[0],a,p+.5,f,o,`hsl(${255===n?150:1.5*n},55%,50%)`)}u+=i,g+=i}}}({ctx:e,feat:t,region:P,bpPerPx:T,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))});break;case"perBaseLettering":!function({ctx:e,feat:t,region:r,bpPerPx:l,colorMap:o,colorContrastMap:n,charWidth:i,charHeight:a,canvasWidth:f,cigarOps:_}){let p=a-2,{feature:d,topPx:u,heightPx:g}=t,h=d.get("seq"),m=1/l,b=d.get("start"),v=0,T=0;if(h)for(let t=0;t<_.length;t+=2){let a=+_[t],d=_[t+1];if("S"===d||"I"===d)v+=a;else if("D"===d||"N"===d)T+=a;else if("M"===d||"X"===d||"="===d){for(let t=0;t<a;t++){let a=h[v+t],_=b+T+t,[d]=(0,s.bpSpanPx)(_,_+1,r,l);c(e,d,u,m+.5,g,f,o[a]),m>=i&&g>=p&&(e.fillStyle=n[a],e.fillText(a,d+(m-i)/2+1,u+g))}v+=a,T+=a}}}({ctx:e,feat:t,region:P,bpPerPx:T,colorMap:o,colorContrastMap:n,charWidth:_,charHeight:p,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))});break;case"modifications":!function({ctx:e,feat:t,region:r,bpPerPx:l,renderArgs:o,canvasWidth:n,cigarOps:i}){var a,f;let{feature:_,topPx:p,heightPx:g}=t,{colorBy:h,visibleModifications:m={}}=o;if(!_.get("seq"))return;let b=_.get("start"),v=null==(a=null==h?void 0:h.modifications)?void 0:a.isolatedModification,T=null==(f=null==h?void 0:h.modifications)?void 0:f.twoColor,x=(0,d.r)(_,i);if(x){let t=0;for(let{allProbs:o,prob:i,type:a}of x){let f=b+t,[_,d]=(0,s.bpSpanPx)(f,f+1,r,l),h=m[a];if(!h)return void console.warn(`${a} not known yet`);if(v&&h.type!==v)return;let x=h.color||"black",C=1-(0,s.sum)(o);if(T&&C>(0,s.max)(o)){let t=(0,u.yr)("blue",C),r=d-_+.5;c(e,_,p,r,g,n,t)}else{let t=(0,u.yr)(x,i),r=d-_+.5;c(e,_,p,r,g,n,t)}t++}}}({ctx:e,feat:t,region:P,bpPerPx:T,renderArgs:r,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))});break;case"methylation":!function({ctx:e,feat:t,region:r,bpPerPx:l,renderArgs:o,canvasWidth:n,cigarOps:i}){let{regionSequence:a}=o,{feature:f,topPx:_,heightPx:p}=t;if(!a)throw Error("region sequence required for methylation");if(!f.get("seq"))return;let d=f.get("start"),u=f.get("end"),{methBins:m,methProbs:b,hydroxyMethBins:v,hydroxyMethProbs:T}=(0,h.Ps)(f,i);function x(e){if(m[e]){let t=b[e]||0;return(t>.5?(0,g.colord)("red").alpha((t-.5)*2):(0,g.colord)("blue").alpha(1-2*t)).toHslString()}if(v[e]){let t=T[e]||0;return(t>.5?(0,g.colord)("pink").alpha((t-.5)*2):(0,g.colord)("purple").alpha(1-2*t)).toHslString()}}let C=a.toLowerCase();for(let t=0;t<u-d;t++){let o=t+d,i=C[o-r.start+1],a=C[o-r.start+2];if("c"===i&&"g"===a)if(l>2){let[i,a]=(0,s.bpSpanPx)(o,o+2,r,l),f=a-i+.5;c(e,i,_,f,p,n,x(t)||x(t+1)||"blue")}else{let[i,a]=(0,s.bpSpanPx)(o,o+1,r,l),f=a-i+.5;c(e,i,_,f,p,n,x(t)||"blue");let[d,u]=(0,s.bpSpanPx)(o+1,o+2,r,l),g=u-d+.5;c(e,d,_,g,p,n,x(t+1)||"blue")}}}({ctx:e,feat:t,region:P,bpPerPx:T,renderArgs:r,canvasWidth:b,cigarOps:(0,f.eL)(M.get("CIGAR"))})}}({ctx:e,feat:o,renderArgs:m,defaultColor:P,colorMap:k,colorContrastMap:R,charWidth:O,charHeight:I,canvasWidth:r}),function({ctx:e,feat:t,renderArgs:r,minSubfeatureWidth:l,largeInsertionIndicatorScale:o,mismatchAlpha:n,charWidth:i,charHeight:a,colorMap:f,colorContrastMap:_,hideSmallIndels:p,canvasWidth:d,drawSNPsMuted:u,drawIndels:h=!0}){let{bpPerPx:m,regions:b}=r,{heightPx:v,topPx:T,feature:x}=t,C=b[0],S=x.get("start"),w=Math.min(1/m,2),y=x.get("mismatches"),M=a-2,P=C.reversed?1/m+1:-1;if(y){for(let t of y){let r=S+t.start,o=t.length,a=t.base,[b,x]=(0,s.bpSpanPx)(r,r+o,C,m),y=Math.max(l,x-b);if("mismatch"===t.type){if(!u){let r=f[t.base]||"#888";c(e,Math.round(b),T,y,v,d,n&&void 0!==t.qual?(0,g.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r)}if(y>=i&&v>=M){let r=u?"black":_[t.base]||"black";e.fillStyle=n&&void 0!==t.qual?(0,g.colord)(r).alpha(Math.min(1,t.qual/50)).toHslString():r,e.fillText(a,b+(y-i)/2+1,T+v)}}else if("deletion"===t.type&&h){let r=t.length;if(!p||r>=10){c(e,b,T,Math.abs(b-x),v,d,f.deletion);let r=`${t.length}`,l=(0,s.measureText)(r,10);y>=l&&v>=M&&(e.fillStyle=_.deletion,e.fillText(r,(b+x)/2-l/2,T+v))}}else if("insertion"===t.type&&h){let r=b+P,l=+t.base||t.length,o=Math.max(0,Math.min(1.2,1/m));if(l<10&&!p&&(c(e,r,T,o,v,d,f.insertion),1/m>=i&&v>=M)){let l=Math.round(r-o);c(e,l,T,3*o,1,d),c(e,l,T+v-1,3*o,1,d),e.fillText(`(${t.base})`,r+3,T+v)}}else if("hardclip"===t.type||"softclip"===t.type){let r=b+P,o=f[t.type],n=Math.max(l,w);if(c(e,r,T,n,v,d,o),1/m>=i&&v>=M){let l=r-n;c(e,l,T,3*n,1,d),c(e,l,T+v-1,3*n,1,d),e.fillText(`(${t.base})`,r+3,T+v)}}else"skip"===t.type&&b+y>0&&c(e,Math.max(0,b),T+v/2-1,y-1.5*(m>10)+Math.min(b,0),1,d,f.skip)}if(h)for(let t of y){let r=S+t.start,l=t.length,n=+t.base||t.length;if("insertion"===t.type&&n>=10){let[t]=(0,s.bpSpanPx)(r,r+l,C,m),i=`${n}`;if(m>o)c(e,t-1,T,2,v,d,f.insertion);else if(v>a){let r=(0,s.measureText)(i);c(e,t-r/2-5,T,r+10,v,d,"purple"),e.fillStyle=_.insertion,e.fillText(i,t-r/2,T+v)}else c(e,t-2,T,4,v,d,f.insertion)}}}}({ctx:e,feat:o,renderArgs:m,hideSmallIndels:M,mismatchAlpha:S,drawSNPsMuted:L,drawIndels:!0,largeInsertionIndicatorScale:y,minSubfeatureWidth:w,charWidth:O,charHeight:I,colorMap:k,colorContrastMap:R,canvasWidth:r}),T&&function({ctx:e,feat:t,renderArgs:r,config:o,theme:n,colorMap:i,canvasWidth:a}){let{feature:_,topPx:d,heightPx:u}=t,{regions:g,bpPerPx:h}=r,m=g[0],b=(0,l.readConfObject)(o,"minSubfeatureWidth"),v=_.get("mismatches"),T=_.get("seq"),{charWidth:x,charHeight:C}=p();if(!(T&&v))return;let S=C-2,w=0,y=0,M=_.get("CIGAR"),P=(0,f.eL)(M);for(let t=0;t<P.length;t+=2){let r=P[t+1],l=+P[t];if("S"===r){for(let r=0;r<l;r++){let o=T[w+r],f=_.get("start")-(0===t?l:0)+y+r,[p,g]=(0,s.bpSpanPx)(f,f+1,m,h),v=Math.max(b,g-p),C=i[o]||"#000000";e.fillStyle=C,c(e,p,d,v,u,a),v>=x&&u>=S&&(e.fillStyle=n.palette.getContrastText(C),e.fillText(o,p+(v-x)/2+1,d+u))}w+=l}"N"===r&&(y+=l),("M"===r||"="===r||"X"===r)&&(y+=l,w+=l),"D"===r&&(y+=l),"I"===r&&(w+=l)}}({ctx:e,feat:o,renderArgs:m,colorMap:k,config:v,theme:A,canvasWidth:r})}}}]);
//# sourceMappingURL=5124.e0bd50752b4d1bd3.js.map