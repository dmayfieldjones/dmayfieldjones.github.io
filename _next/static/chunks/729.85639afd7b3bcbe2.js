"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{90729:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(6477),s=a(40488),n=a(29269),i=a(15715),u=a(64446),d=a(31232),o=a(41431),l=a(96885),c=a(72796);class f extends n.BaseFeatureDataAdapter{async configurePre(e){let t=this.pluginManager,a=new r.C({filehandle:(0,u.openLocation)(this.getConf("bigBedLocation"),t)}),n=await a.getHeader(e),i=new s.A({autoSql:n.autoSql});return{bigbed:a,header:n,parser:i}}async configure(e){return this.cachedP||(this.cachedP=this.configurePre(e).catch(e=>{throw this.cachedP=void 0,e})),this.cachedP}async getRefNames(e){let{header:t}=await this.configure(e);return Object.keys(t.refsByName)}async getRefNameAliases(e){let{header:t}=await this.configure(e);return(await Promise.all(Object.keys(t.refsByName).map(async e=>(await (0,o._)(this.getFeatures({assemblyName:"",refName:e,start:0,end:1}).pipe((0,l.$)())))[0]))).map(e=>e.toJSON()).map(e=>({refName:e.ucsc,aliases:[e.ncbi,e.refseq,e.genbank],override:!0}))}async getData(){let e=await this.getRefNames(),t=[];for(let a of e){let e=await (0,o._)(this.getFeatures({assemblyName:"unknown",refName:a,start:0,end:Number.MAX_SAFE_INTEGER}).pipe((0,l.$)()));t.push(e)}return t.flat()}async getHeader(e){let{parser:t,header:a}=await this.configure(e),{version:r,fileType:s}=a,{fields:n,...i}=t.autoSql;return{version:r,fileType:s,autoSql:{...i},fields:Object.fromEntries(n.map(({name:e,comment:t})=>[e,t]))}}async getFeaturesHelper({query:e,opts:t,observer:a,allowRedispatch:r,originalQuery:s=e}){var n;let{statusCallback:u=()=>{}}=t,d=this.getConf("scoreColumn"),o=this.getConf("aggregateField"),{parser:l,bigbed:f}=await (0,i.updateStatus)("Downloading header",u,()=>this.configure(t)),h=await (0,i.updateStatus)("Downloading features",u,()=>f.getFeatures(e.refName,e.start,e.end,{basesPerSpan:e.end-e.start}));if(r&&h.length){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,n=!1;for(let e of h)e.start<r&&(r=e.start),e.end>s&&(s=e.end),e[o]&&(n=!0);if(n&&(s>e.end||r<e.start))return void await this.getFeaturesHelper({query:{...e,start:r-5e5,end:s+5e5},opts:t,observer:a,allowRedispatch:!1,originalQuery:e})}let m={};if(h.some(e=>void 0===e.uniqueId))throw Error("found uniqueId undefined");for(let t of h){let r=[e.refName,`${t.start}`,`${t.end}`,...(null==(n=t.rest)?void 0:n.split("	"))||[]],u=l.parseLine(r,{uniqueId:t.uniqueId}),f=u[o];m[f]||(m[f]=[]);let{uniqueId:h,type:p,chrom:g,chromStart:N,chromEnd:w,description:b,chromStarts:y,blockStarts:I,blockSizes:S,score:q,blockCount:F,thickStart:k,thickEnd:v,strand:E,..._}=u,C=(0,c.np)({..._,scoreColumn:d,splitLine:r,parser:l,uniqueId:h,start:t.start,end:t.end,refName:e.refName});f?m[f].push(C):(0,i.doesIntersect2)(C.start,C.end,s.start,s.end)&&a.next(new i.SimpleFeature({id:`${this.id}-${h}`,data:C}))}Object.entries(m).map(([t,r])=>{var n,u;let d=(0,i.min)(r.map(e=>e.start)),o=(0,i.max)(r.map(e=>e.end));if((0,i.doesIntersect2)(d,o,s.start,s.end)){let s=r.sort((e,t)=>e.uniqueId.localeCompare(t.uniqueId));a.next(new i.SimpleFeature({id:`${this.id}-${null==(n=s[0])?void 0:n.uniqueId}-parent`,data:{type:"gene",subfeatures:s,strand:(null==(u=s[0])?void 0:u.strand)||1,name:t,start:d,end:o,refName:e.refName}}))}}),a.complete()}getFeatures(e,t={}){return(0,d.ObservableCreate)(async a=>{try{await this.getFeaturesHelper({query:{...e,start:e.start,end:e.end},opts:t,observer:a,allowRedispatch:!0})}catch(e){a.error(e)}},t.stopToken)}freeResources(){}}}}]);
//# sourceMappingURL=729.85639afd7b3bcbe2.js.map